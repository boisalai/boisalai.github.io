"use strict";(self.webpackChunkmy_doc=self.webpackChunkmy_doc||[]).push([[9041],{83265:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>d});var r=t(85893),o=t(11151);const a={sidebar_label:"Advanced Retrieval for AI with Chroma",sidebar_position:8},i="Advanced Retrieval for AI with Chroma",s={id:"courses/deeplearning-ai/p08-advanced-rag",title:"Advanced Retrieval for AI with Chroma",description:"2024-01-05",source:"@site/docs/courses/deeplearning-ai/p08-advanced-rag.md",sourceDirName:"courses/deeplearning-ai",slug:"/courses/deeplearning-ai/p08-advanced-rag",permalink:"/docs/courses/deeplearning-ai/p08-advanced-rag",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/courses/deeplearning-ai/p08-advanced-rag.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_label:"Advanced Retrieval for AI with Chroma",sidebar_position:8},sidebar:"tutorialSidebar",previous:{title:"LangChain Chat with Your Data",permalink:"/docs/courses/deeplearning-ai/p07-chat-with-your-data/"},next:{title:"Vector Databases from Embeddings to Applications",permalink:"/docs/courses/deeplearning-ai/p06-vector-database/vector-database"}},c={},d=[{value:"Overview of embeddings-based retrieval",id:"overview-of-embeddings-based-retrieval",level:2}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,o.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"advanced-retrieval-for-ai-with-chroma",children:"Advanced Retrieval for AI with Chroma"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"2024-01-05"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"overview-of-embeddings-based-retrieval",children:"Overview of embeddings-based retrieval"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from helper_utils import word_wrap\n\nfrom pypdf import PdfReader\n\nreader = PdfReader("microsoft_annual_report_2022.pdf")\npdf_texts = [p.extract_text().strip() for p in reader.pages]\n\n# Filter the empty strings\npdf_texts = [text for text in pdf_texts if text]\n\n# Show the first page\nprint(word_wrap(pdf_texts[0]))\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from langchain.text_splitter import (\n  RecursiveCharacterTextSplitter,\n  SentenceTransformersTokenTextSplitter\n)\n\ncharacter_splitter = RecursiveCharacterTextSplitter(\n    separators=["\\n\\n", "\\n", ". ", " ", ""],\n    chunk_size=1000,\n    chunk_overlap=0\n)\ncharacter_split_texts = character_splitter.split_text(\'\\n\\n\'.join(pdf_texts))\n\nprint(word_wrap(character_split_texts[10]))\nprint(f"\\nTotal chunks: {len(character_split_texts)}")\n# Total chunks: 347.\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'token_splitter = SentenceTransformersTokenTextSplitter(\n  chunk_overlap=0, tokens_per_chunk=256)\n\ntoken_split_texts = []\nfor text in character_split_texts:\n    token_split_texts += token_splitter.split_text(text)\n\nprint(word_wrap(token_split_texts[10]))\nprint(f"\\nTotal chunks: {len(token_split_texts)}")\n# Total chunks: 349.\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import chromadb\nfrom chromadb.utils.embedding_functions import SentenceTransformerEmbeddingFunction\n\nembedding_function = SentenceTransformerEmbeddingFunction()\nprint(embedding_function([token_split_texts[10]]))\n"})}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"https://arxiv.org/abs/1908.10084",children:"Sentence-BERT: Sentence Embeddings using Siamese BERT-Networks"})," for more details."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'chroma_client = chromadb.Client()\nchroma_collection = chroma_client.create_collection(\n  "microsoft_annual_report_2022", embedding_function=embedding_function)\n\nids = [str(i) for i in range(len(token_split_texts))]\n\nchroma_collection.add(ids=ids, documents=token_split_texts)\nchroma_collection.count()\n# 349\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"query = \"What was the total revenue?\"\n\nresults = chroma_collection.query(query_texts=[query], n_results=5)\nretrieved_documents = results['documents'][0]\n\nfor document in retrieved_documents:\n    print(word_wrap(document))\n    print('\\n')\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import os\nimport openai\nfrom openai import OpenAI\n\nfrom dotenv import load_dotenv, find_dotenv\n_ = load_dotenv(find_dotenv()) # read local .env file\nopenai.api_key = os.environ[\'OPENAI_API_KEY\']\n\nopenai_client = OpenAI()\n\ndef rag(query, retrieved_documents, model="gpt-3.5-turbo"):\n    information = "\\n\\n".join(retrieved_documents)\n\n    messages = [\n        {\n            "role": "system",\n            "content": "You are a helpful expert financial research assistant. Your users are asking questions about information contained in an annual report."\n            "You will be shown the user\'s question, and the relevant information from the annual report. Answer the user\'s question using only this information."\n        },\n        {"role": "user", "content": f"Question: {query}. \\n Information: {information}"}\n    ]\n    \n    response = openai_client.chat.completions.create(\n        model=model,\n        messages=messages,\n    )\n    content = response.choices[0].message.content\n    return content\n\noutput = rag(query=query, retrieved_documents=retrieved_documents)\nprint(word_wrap(output))\n# The total revenue for the year ended June 30, 2022 was $198,270 million.\n'})})]})}function p(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},11151:(e,n,t)=>{t.d(n,{Z:()=>s,a:()=>i});var r=t(67294);const o={},a=r.createContext(o);function i(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);