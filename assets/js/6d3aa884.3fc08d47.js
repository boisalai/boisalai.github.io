"use strict";(self.webpackChunkmy_doc=self.webpackChunkmy_doc||[]).push([[1918],{26243:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var t=s(85893),r=s(11151);const i={sidebar_label:"VBA",sidebar_position:5},l="VBA",o={id:"references/languages/vba",title:"VBA",description:"Get data from closed book",source:"@site/docs/references/languages/vba.md",sourceDirName:"references/languages",slug:"/references/languages/vba",permalink:"/docs/references/languages/vba",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/references/languages/vba.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_label:"VBA",sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"SAS",permalink:"/docs/references/languages/sas"},next:{title:"JAX",permalink:"/docs/references/languages/jax"}},a={},c=[{value:"Get data from closed book",id:"get-data-from-closed-book",level:2},{value:"Lunch python script from VBA",id:"lunch-python-script-from-vba",level:2},{value:"Send mail and progress bar",id:"send-mail-and-progress-bar",level:2},{value:"ADO Connection",id:"ado-connection",level:2},{value:"Donn\xe9es syst\xe8mes",id:"donn\xe9es-syst\xe8mes",level:2},{value:"Obtenir l&#39;espace m\xe9moire RAM",id:"obtenir-lespace-m\xe9moire-ram",level:2},{value:"Explorer les sous-r\xe9pertoires",id:"explorer-les-sous-r\xe9pertoires",level:2},{value:"See also",id:"see-also",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"vba",children:"VBA"}),"\n",(0,t.jsx)(n.h2,{id:"get-data-from-closed-book",children:"Get data from closed book"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-vba",children:'Option Explicit\n \n\'credit for this technique goes to John Walkenback\n\'http://j-walk.com/ss/excel/tips/tip82.htm\nSub GetDataDemo()\n \n      Dim FilePath$, Row&, Column&, Address$\n     \n      \'change constants & FilePath below to suit\n      \'***************************************\n      Const FileName$ = "Book1.xls"\n      Const SheetName$ = "Sheet1"\n      Const NumRows& = 10\n      Const NumColumns& = 10\n      FilePath = ActiveWorkbook.Path & "\\"\n      \'***************************************\n     \n      DoEvents\n      Application.ScreenUpdating = False\n      If Dir(FilePath & FileName) = Empty Then\n            MsgBox "The file " & FileName & " was not found", , "File Doesn\'t Exist"\n            Exit Sub\n      End If\n      For Row = 1 To NumRows\n            For Column = 1 To NumColumns\n                  Address = Cells(Row, Column).Address\n                  Cells(Row, Column) = GetData(FilePath, FileName, SheetName, Address)\n                  Columns.AutoFit\n            Next Column\n      Next Row\n      ActiveWindow.DisplayZeros = False\nEnd Sub\n \nPrivate Function GetData(Path, File, Sheet, Address)\n      Dim Data$\n      Data = "\'" & Path & "[" & File & "]" & Sheet & "\'!" & _\n            Range(Address).Range("A1").Address(, , xlR1C1)\n      GetData = ExecuteExcel4Macro(Data)\nEnd Function\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-vba",children:'Option Explicit\n\nSub Sample()\n    Dim wbPath As String, wbName As String\n    Dim wsName As String, cellRef As String\n    Dim Ret As String\n\n    wbPath = "C:\\Users\\Temp\\"\n    wbName = "Foo.xls"\n    wsName = "ACL"\n    cellRef = "C3"\n\n    Ret = "\'" & wbPath & "[" & wbName & "]" & _\n          wsName & "\'!" & Range(cellRef).Address(True, True, -4150)\n\n    MsgBox ExecuteExcel4Macro(Ret)\nEnd Sub\n'})}),"\n",(0,t.jsx)(n.p,{children:"See also :"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://silkyroad.developpez.com/VBA/ClasseursFermes/",children:"https://silkyroad.developpez.com/VBA/ClasseursFermes/"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://ourcodeworld.com/articles/read/1534/how-to-run-a-sql-query-with-vba-on-excel-spreadsheets-data",children:"https://ourcodeworld.com/articles/read/1534/how-to-run-a-sql-query-with-vba-on-excel-spreadsheets-data"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/previous-versions/tn-archive/ee692882(v=technet.10)?redirectedfrom=MSDN",children:"https://docs.microsoft.com/en-us/previous-versions/tn-archive/ee692882(v=technet.10)?redirectedfrom=MSDN"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.excelsirji.com/vba-code-to-read-excel-data-using-connection-string/",children:"https://www.excelsirji.com/vba-code-to-read-excel-data-using-connection-string/"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"http://www.vbaexpress.com/forum/showthread.php?51081-Need-Help-with-Querying-an-Excel-Table-in-VBA-ADO",children:"http://www.vbaexpress.com/forum/showthread.php?51081-Need-Help-with-Querying-an-Excel-Table-in-VBA-ADO"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://jeffpar.github.io/kbarchive/kb/257/Q257819/",children:"https://jeffpar.github.io/kbarchive/kb/257/Q257819/"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://morsagmon.com/blog/the-power-of-sql-applied-to-excel-tables-for-fast-results/",children:"https://morsagmon.com/blog/the-power-of-sql-applied-to-excel-tables-for-fast-results/"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"lunch-python-script-from-vba",children:"Lunch python script from VBA"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-vba",children:'Sub RunPythonScript()\n\n\'Declare Variables\nDim objShell As Object\nDim PythonExe, PythonScript As String\n\n\'Create a new Object shell.\nSet objShell = VBA.CreateObject("Wscript.Shell")\n\n\'Provide file path to Python.exe\n\'USE TRIPLE QUOTES WHEN FILE PATH CONTAINS SPACES.\nPythonExe = """C:\\Program Files (x86)\\Microsoft Visual Studio\\Shared\\Python36_64\\python.exe"""\nPythonScript = "C:\\Users\\Alex\\Desktop\\ExcelToPowerPoint.py"\n\n\'Run the Python Script\nobjShell.Run PythonExe & PythonScript\n\nEnd Sub\n'})}),"\n",(0,t.jsx)(n.h2,{id:"send-mail-and-progress-bar",children:"Send mail and progress bar"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-vba",children:'Sub BoutonBrouillonsClic()\n    Dim ol As Outlook.Application\n    Dim mail As Outlook.MailItem\n    Dim sht As Worksheet\n    Dim shtMessage As Worksheet\n    Dim rowIndex As Integer\n    Dim signature As String\n    \n    Set sht = Workbooks(1).Worksheets("Liste distribution")\n    Set shtMessage = Workbooks(1).Worksheets("Message")\n    \n    rowIndex = 2\n    Feuil1.prgBar.Max = sht.Cells.Find("*", [A1], , , xlByRows, xlPrevious).Row - 1\n    Feuil1.prgBar.Value = 0\n    Feuil1.prgBar.Visible = True\n    \n    Set ol = New Outlook.Application\n    \n    Set mail = ol.CreateItem(olMailItem)\n    mail.Display\n    \'signature = mail.HTMLBody\n    mail.Close olDiscard\n    \n    Do While sht.Cells(rowIndex, 1).Value <> ""\n        If Dir$(Range("CheminDestination").Value & "\\" & sht.Cells(rowIndex, 7).Value) <> "" Then\n            Set mail = ol.CreateItem(olMailItem)\n            mail.To = sht.Cells(rowIndex, 3).Value\n            mail.CC = sht.Cells(rowIndex, 4).Value\n            mail.Subject = shtMessage.Cells(4, 2).Value\n            mail.HTMLBody = "<div style=""font: 1em Arial;"">" & Replace(Replace(Replace(Replace(shtMessage.Cells(6, 2).Value, "[NoProjet]", sht.Cells(rowIndex, 2)), "[Date fin]", Range("DateFinPeriode").Value), "[NomProjet]", sht.Cells(rowIndex, 3)), vbLf, "<br>") & "</div>" & signature\n            \' "<div style=""font: 1em Arial;"">" & shtMessage.Cells(6, 2).Value & "</div>" & signature\n            mail.SentOnBehalfOfName = "infrastructures@education.gouv.qc.ca"\n            mail.Save\n            mail.Attachments.Add Range("CheminDestination").Value & "\\" & sht.Cells(rowIndex, 5).Value\n            mail.Attachments.Add Range("CheminDestination").Value & "\\" & sht.Cells(rowIndex, 6).Value\n            mail.Attachments.Add Range("CheminDestination").Value & "\\" & sht.Cells(rowIndex, 7).Value\n            mail.Close olSave\n        End If\n        rowIndex = rowIndex + 1\n        Feuil1.prgBar.Value = Feuil1.prgBar.Value + 1\n    Loop\n    Call MsgBox("G\xe9n\xe9ration des brouillons termin\xe9e !")\n    Feuil1.prgBar.Visible = False\nEnd Sub\n'})}),"\n",(0,t.jsx)(n.h2,{id:"ado-connection",children:"ADO Connection"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-vba",children:"Sub GetDataFromADO()  \n'Declare variables'   \nSet objMyConn = New ADODB.Connection    \nSet objMyRecordset = New ADODB.Recordset    \nDim strSQL As String \n \n'Open Connection'    \nobjMyConn.ConnectionString = 'Provider=SQLOLEDB;Data Source=myAzureServer;Initial Catalog=MyDatabase;User ID=abc;Password=abc;'    \nobjMyConn.Open  \n'Set and Excecute SQL Command'    \nstrSQL = 'select * from myTable'  \n\n'Open Recordset'    \nSet objMyRecordset.ActiveConnection = objMyConn    \nobjMyRecordset.Open strSQL      \n\n'Copy Data to Excel'    \nActiveSheet.Range('A1').CopyFromRecordset (objMyRecordset)\n\nEnd Sub\n"})}),"\n",(0,t.jsx)(n.h2,{id:"donn\xe9es-syst\xe8mes",children:"Donn\xe9es syst\xe8mes"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-vba",children:'\'Obtenir le code utilisateur (ex. boial13).\nPublic Function CurrentUserName() As String\n    CurrentUserName = CreateObject("wscript.network").UserName\nEnd Function\n \nPublic Sub DeleteFile(File)\n    If Len(Dir(File)) > 0 Then\n        Kill File\n    End If\nEnd Sub\n\nPublic Sub Test1()\n    Dim WSH As Object\n    Set WSH = VBA.CreateObject("WScript.Shell")\n    Dim WaitOnReturn As Boolean: WaitOnReturn = True\n    Dim WindowStyle As Integer: WindowStyle = 1\n   \n    Dim FileNum As Long\n    Dim BatchFile As String: BatchFile = "C:\\Alain\\go.bat"\n    Dim OutputFile As String: OutputFile = "C:\\Alain\\go.txt"\n    Dim Line As String\n    Dim Number As Integer\n    Dim record As String\n   \n    FileNum = FreeFile()\n    Open BatchFile For Output As #FileNum\n    Print #FileNum, "SYSTEMINFO /FO LIST > " & OutputFile\n    Close #FileNum\n   \n    WSH.Run BatchFile, WindowStyle, WaitOnReturn\n    \n    DeleteFile BatchFile\n   \n    FileNum = FreeFile()\n    Open OutputFile For Input As #FileNum\n   \n    Number = 0\n    record = "Code utilisateur : " & CurrentUserName\n    While Not EOF(FileNum)\n        Number = Number + 1\n        Line Input #FileNum, Line\n        If Number = 2 Then\n            record = record & vbCrLf & "Nom de l\'h\xf4te : " & Mid(Line, 45)\n        ElseIf Number = 11 Then\n            record = record & vbCrLf & "Date d\'installation originale : " & Mid(Line, 45)\n        ElseIf Number = 15 Then\n            record = record & vbCrLf & "Type du syst\xe8me : " & Mid(Line, 45)\n        ElseIf Number = 16 Then\n            record = record & vbCrLf & "Processeur(s) : " & Mid(Line, 45)\n        ElseIf Number = 17 Then\n            \'Record = Record & vbCrLf & "Processeur : " & Mid(Line, 45)\n        ElseIf Number = 25 Then\n            record = record & vbCrLf & "M\xe9moire physique totale : " & Mid(Line, 45)\n        ElseIf Number = 26 Then\n            record = record & vbCrLf & "M\xe9moire physique disponible : " & Mid(Line, 45)\n        ElseIf Number = 29 Then\n            record = record & vbCrLf & "M\xe9moire virtuelle en cours d\'utilisation : " & Mid(Line, 45)\n        End If\n    Wend\n       \n    Close #FileNum\n    DeleteFile OutputFile\n \n    record = Replace(record, "\xff", " ")\n   \n    \'Afficher le r\xe9sultat du record dans le label.\n    Debug.Print "Information sur le syst\xe8me" & Chr(10) & record\nEnd Sub\n'})}),"\n",(0,t.jsx)(n.p,{children:"The previous code returns something like this."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-txt",children:"Information sur le syst\xe8me\nCode utilisateur : boial13\nNom de l'h\xf4te : PN218288\nDate d'installation originale : 2017-09-07, 11:13:19\nType du syst\xe8me : x64-based PC\nProcesseur(s) : 1 processeur(s) install\u201a(s).\nM\xe9moire physique totale : 8 108 Mo\nM\xe9moire physique disponible : 3 428 Mo\nM\xe9moire virtuelle en cours d'utilisation : 4 967 Mo\n"})}),"\n",(0,t.jsx)(n.h2,{id:"obtenir-lespace-m\xe9moire-ram",children:"Obtenir l'espace m\xe9moire RAM"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-vba",children:'Function SysMemory()\n    Dim oInstance\n    Dim colInstances\n    Dim dRam As Double\n    Set colInstances = GetObject("winmgmts:").ExecQuery("SELECT * FROM Win32_PhysicalMemory")\n    For Each oInstance In colInstances\n        dRam = dRam + oInstance.Capacity\n    Next\n    SysMemory = dRam / 1024 / 1024 & "MB"\nEnd Function\n \nPublic Sub Test()\n    Debug.Print SysMemory\nEnd Sub\n'})}),"\n",(0,t.jsx)(n.h2,{id:"explorer-les-sous-r\xe9pertoires",children:"Explorer les sous-r\xe9pertoires"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-vba",children:'Sub ListFiles()\n    Dim fs As Object\n    Dim folder As Object\n    Dim subfolder As Object\n    Dim file As Object\n    Dim Row As Integer\n\n    Set fs = CreateObject("Scripting.FileSystemObject")\n\n    \' Changez ceci par le chemin de votre r\xe9pertoire racine\n    Set folder = fs.GetFolder(\\\\chemin\\vers\\le\\r\xe9pertoire\\racine)\n\n    \' Commencer \xe0 \xe9crire \xe0 partir de la deuxi\xe8me ligne\n    Row = 2\n\n    \' En-t\xeates pour les donn\xe9es\n    With ThisWorkbook.Sheets(1)\n        .Cells(1, 1).Value = "Chemin du r\xe9pertoire"\n        .Cells(1, 2).Value = "Derni\xe8re Date de Mise \xe0 Jour"\n        .Cells(1, 3).Value = "Nombre de Fichiers"\n        .Cells(1, 4).Value = "Dimension Totale (Mo)"\n    End With\n\n    \' Appeler la fonction r\xe9cursive pour parcourir les r\xe9pertoires\n    Call ListFolderDetails(folder, Row)\n    MsgBox "Liste compl\xe9t\xe9e!"\nEnd Sub\n\n\' Fonction r\xe9cursive pour parcourir les r\xe9pertoires\nSub ListFolderDetails(folder As Object, ByRef Row As Integer)\n    Dim subfolder As Object\n    Dim file As Object\n    Dim fileSize As Double\n    Dim latestDate As Date\n    Dim fileCount As Long\n    fileSize = 0\n    latestDate = DateSerial(1900, 1, 1)\n\n    \' Compter les fichiers et accumuler la taille\n    For Each file In folder.Files\n        fileSize = fileSize + file.Size\n        fileCount = fileCount + 1\n        If file.DateLastModified > latestDate Then\n            latestDate = file.DateLastModified\n        End If\n    Next file\n\n    \' Convertir la taille en Mo\n    fileSize = fileSize / 1024 / 1024\n\n    \' \xc9crire les d\xe9tails dans Excel\n    With ThisWorkbook.Sheets(1)\n        .Cells(Row, 1).Value = folder.Path\n        .Cells(Row, 2).Value = latestDate\n        .Cells(Row, 3).Value = fileCount\n        .Cells(Row, 4).Value = fileSize\n    End With\n\n    \' Incr\xe9menter la ligne\n    Row = Row + 1\n\n    \' Parcourir les sous-dossiers\n    For Each subfolder In folder.SubFolders\n        Call ListFolderDetails(subfolder, Row)\n    Next subfolder\nEnd Sub\n'})}),"\n",(0,t.jsx)(n.h2,{id:"see-also",children:"See also"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/areed1192",children:"https://github.com/areed1192"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://gist.github.com/ironoah/1743936",children:"How To Use ADO with Excel Data from VBA"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://dev.mysql.com/doc/connector-odbc/en/connector-odbc-examples-programming-vb-ado.html",children:"https://dev.mysql.com/doc/connector-odbc/en/connector-odbc-examples-programming-vb-ado.html"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://bettersolutions.com/vba/macros/best-practices.htm",children:"https://bettersolutions.com/vba/macros/best-practices.htm"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://vbaskill.com/",children:"VBA Skills"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.goskills.com/Excel/Resources/VBA-code-library",children:"https://www.goskills.com/Excel/Resources/VBA-code-library"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.soa.org/news-and-publications/newsletters/compact/2012/january/com-2012-iss42/excel-vba-speed-and-efficiency/",children:"https://www.soa.org/news-and-publications/newsletters/compact/2012/january/com-2012-iss42/excel-vba-speed-and-efficiency/"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"http://www.cpearson.com/excel/optimize.htm",children:"http://www.cpearson.com/excel/optimize.htm"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.ozgrid.com/VBA/SpeedingUpVBACode.htm",children:"https://www.ozgrid.com/VBA/SpeedingUpVBACode.htm"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.automateexcel.com/vba/add-and-name-worksheets/",children:"https://www.automateexcel.com/vba/add-and-name-worksheets/"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://excelchamps.com/vba/",children:"https://excelchamps.com/vba/"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.rondebruin.nl/index.htm",children:"https://www.rondebruin.nl/index.htm"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},11151:(e,n,s)=>{s.d(n,{Z:()=>o,a:()=>l});var t=s(67294);const r={},i=t.createContext(r);function l(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);