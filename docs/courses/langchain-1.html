<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-courses/langchain-1" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">LangChain for LLM Application Development | Alain Boisvert</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://boisalai.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://boisalai.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://boisalai.github.io/docs/courses/langchain-1"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="LangChain for LLM Application Development | Alain Boisvert"><meta data-rh="true" name="description" content="2023-08-25"><meta data-rh="true" property="og:description" content="2023-08-25"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://boisalai.github.io/docs/courses/langchain-1"><link data-rh="true" rel="alternate" href="https://boisalai.github.io/docs/courses/langchain-1" hreflang="en"><link data-rh="true" rel="alternate" href="https://boisalai.github.io/docs/courses/langchain-1" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Alain Boisvert RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Alain Boisvert Atom Feed">



<link rel="stylesheet" href="/fonts/font-awesome/fontawesome.css">
<link rel="stylesheet" href="/fonts/font-awesome/solid.css">
<link rel="stylesheet" href="/fonts/font-awesome/regular.css">
<link rel="stylesheet" href="/fonts/font-awesome/brands.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.b5c999da.css">
<script src="/assets/js/runtime~main.e6737288.js" defer="defer"></script>
<script src="/assets/js/main.a09b2bce.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Alain Boisvert</b></a><a class="navbar__item navbar__link" target="" href="/docs/courses/ift-7022">IFT-7022</a><a class="navbar__item navbar__link" target="" href="/docs/courses/gif-7005">GIF-7005</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/boisalai" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link fa-brands fa-github"> </a><a href="https://www.linkedin.com/in/alain-boisvert-98b058156/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link fa-brands fa-linkedin-in"> </a><a href="mailto:ay.boisvert@gmail.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link fa-solid fa-envelope"> </a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Alain Boisvert</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cv">Curriculum vitæ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/learning">Learning path</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/certificates">Certificates</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/courses">Courses</a><button aria-label="Collapse sidebar category &#x27;Courses&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/courses/gif-7005">GIF-7005 Introduction à l&#x27;apprentissage automatique</a><button aria-label="Expand sidebar category &#x27;GIF-7005 Introduction à l&#x27;apprentissage automatique&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/courses/ift-7022">IFT-7022 Traitement automatique de la langue naturelle</a><button aria-label="Expand sidebar category &#x27;IFT-7022 Traitement automatique de la langue naturelle&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/courses/chatgpt-building-systems">Building Systems with the ChatGPT API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/courses/chatgpt-prompt-engineering">ChatGPT Prompt Engineering for Developers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/courses/fine-tuning-llms">Training and fine-tuning LLMs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/courses/langchain-1">LangChain for LLM Application Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/courses/pair-prog-with-llm">Pair Programming with a Large Language Model</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/courses/chat-with-your-data">LangChain Chat with Your Data</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/references">References</a><button aria-label="Expand sidebar category &#x27;References&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/code-snippets">Code Snippets</a><button aria-label="Expand sidebar category &#x27;Code Snippets&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/courses"><span itemprop="name">Courses</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">LangChain for LLM Application Development</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>LangChain for LLM Application Development</h1>
<blockquote>
<p>2023-08-25</p>
</blockquote>
<p>Short course<br>
<a href="https://www.deeplearning.ai/short-courses/langchain-for-llm-application-development/" target="_blank" rel="noopener noreferrer">LangChain for LLM Application Development</a><br>
DeepLearning.AI<br>
Harrison Chase, Andrew Ng</p>
<ul>
<li>Learn LangChain directly from the creator of the framework, Harrison Chase.</li>
<li>Apply LLMs to your proprietary data to build personal assistants and specialized chatbots.</li>
<li>Use agents, chained calls, and memories to expand your use of LLMs.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2>
<p><a href="https://python.langchain.com" target="_blank" rel="noopener noreferrer">LangChain</a> is a framework
for developing applications powered by language models.</p>
<p>See <a href="https://github.com/langchain-ai/langchain" target="_blank" rel="noopener noreferrer">LangChain repository</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="models-prompts-and-parsers">Models, Prompts and Parsers<a href="#models-prompts-and-parsers" class="hash-link" aria-label="Direct link to Models, Prompts and Parsers" title="Direct link to Models, Prompts and Parsers">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup">Setup<a href="#setup" class="hash-link" aria-label="Direct link to Setup" title="Direct link to Setup">​</a></h3>
<p>Get your <a href="https://platform.openai.com/account/api-keys" target="_blank" rel="noopener noreferrer">OpenAI API Key</a>.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">!pip install python-dotenv</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">!pip install openai</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import openai</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from dotenv import load_dotenv, find_dotenv</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">_ = load_dotenv(find_dotenv()) # read local .env file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">openai.api_key = os.environ[&#x27;OPENAI_API_KEY&#x27;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># account for deprecation of LLM model</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import datetime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Get the current date</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">current_date = datetime.datetime.now().date()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Define the date after which the model should be set to &quot;gpt-3.5-turbo&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">target_date = datetime.date(2024, 6, 12)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Set the model variable based on the current date</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if current_date &gt; target_date:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm_model = &quot;gpt-3.5-turbo&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm_model = &quot;gpt-3.5-turbo-0301&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>See <a href="https://platform.openai.com/docs/models/gpt-3-5" target="_blank" rel="noopener noreferrer">GPT-3.5</a> for the difference between
<code>gpt-3.5-turbo</code> and <code>gpt-3.5-turbo-0301</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="chat-api-openai">Chat API: OpenAI<a href="#chat-api-openai" class="hash-link" aria-label="Direct link to Chat API: OpenAI" title="Direct link to Chat API: OpenAI">​</a></h3>
<p>Let&#x27;s start with a direct API calls to OpenAI. See <a href="https://platform.openai.com/docs/api-reference" target="_blank" rel="noopener noreferrer">OpenAI API Reference</a>.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">def get_completion(prompt, model=llm_model):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    messages = [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: prompt}]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    response = openai.ChatCompletion.create(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        model=model,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        messages=messages,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        temperature=0, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return response.choices[0].message[&quot;content&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">get_completion(&quot;What is 1+1?&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># &#x27;As an AI language model, I can tell you that the answer to 1+1 is 2.&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">customer_email = &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Arrr, I be fuming that me blender lid \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">flew off and splattered me kitchen walls \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">with smoothie! And to make matters worse,\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">the warranty don&#x27;t cover the cost of \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cleaning up me kitchen. I need yer help \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">right now, matey!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">style = &quot;&quot;&quot;American English \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">in a calm and respectful tone</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">prompt = f&quot;&quot;&quot;Translate the text \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">that is delimited by triple backticks </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">into a style that is {style}.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">text: ```{customer_email}```</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;&quot;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">response = get_completion(prompt)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">response</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># &#x27;I am quite upset that my blender lid came off and caused my smoothie to splatter all over </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># my kitchen walls. Additionally, the warranty does not cover the cost of cleaning up the </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># mess. Would you be able to assist me at this time, my friend? Thank you kindly.&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="chat-api-langchain">Chat API: LangChain<a href="#chat-api-langchain" class="hash-link" aria-label="Direct link to Chat API: LangChain" title="Direct link to Chat API: LangChain">​</a></h3>
<p>Let&#x27;s try how we can do the same using LangChain.</p>
<p>See <a href="https://api.python.langchain.com/en/latest/api_reference.html" target="_blank" rel="noopener noreferrer">langchain API Reference</a>
for details about <code>ChatOpenAI</code> and <code>ChatPromptTemplate</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="model">Model<a href="#model" class="hash-link" aria-label="Direct link to Model" title="Direct link to Model">​</a></h4>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">!pip install --upgrade langchain</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chat_models import ChatOpenAI</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># To control the randomness and creativity of the generated</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># text by an LLM, use temperature = 0.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">chat = ChatOpenAI(temperature=0.0, model=llm_model)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">chat</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># ChatOpenAI(verbose=False, callbacks=None, callback_manager=None, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># client=&lt;class &#x27;openai.api_resources.chat_completion.ChatCompletion&#x27;&gt;, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># model_name=&#x27;gpt-3.5-turbo-0301&#x27;, temperature=0.0, model_kwargs={}, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># openai_api_key=None, openai_api_base=None, openai_organization=None, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># request_timeout=None, max_retries=6, streaming=False, n=1, max_tokens=None)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="prompt-template">Prompt template<a href="#prompt-template" class="hash-link" aria-label="Direct link to Prompt template" title="Direct link to Prompt template">​</a></h4>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">template_string = &quot;&quot;&quot;Translate the text \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">that is delimited by triple backticks \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">into a style that is {style}. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">text: ```{text}```</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;&quot;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.prompts import ChatPromptTemplate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">prompt_template = ChatPromptTemplate.from_template(template_string)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">prompt_template.messages[0].prompt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># PromptTemplate(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#   input_variables=[&#x27;style&#x27;, &#x27;text&#x27;], output_parser=None, partial_variables={}, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#   template=&#x27;Translate the text that is delimited by triple backticks into a </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#   style that is {style}. text: ```{text}```\n&#x27;, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#   template_format=&#x27;f-string&#x27;, validate_template=True)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">customer_style = &quot;&quot;&quot;American English in a calm and respectful tone&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">customer_email = &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Arrr, I be fuming that me blender lid \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">flew off and splattered me kitchen walls \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">with smoothie! And to make matters worse, \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">the warranty don&#x27;t cover the cost of \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cleaning up me kitchen. I need yer help \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">right now, matey!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">customer_messages = prompt_template.format_messages(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    style=customer_style,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    text=customer_email)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(type(customer_messages))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(type(customer_messages[0]))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># &lt;class &#x27;list&#x27;&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># &lt;class &#x27;langchain.schema.HumanMessage&#x27;&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(customer_messages[0])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># content=&quot;Translate the text that is delimited by triple backticks into a style that is </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#   American English in a calm and respectful tone\n. text: ```\nArrr, I be fuming that </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#   me blender lid flew off and splattered me kitchen walls with smoothie! And to make </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#   matters worse, the warranty don&#x27;t cover the cost of cleaning up me kitchen. I need </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#   yer help right now, matey!\n```\n&quot; additional_kwargs={} example=False</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Call the LLM to translate to the style of the customer message</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">customer_response = chat(customer_messages)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(customer_response.content)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># I&#x27;m really frustrated that my blender lid flew off and made a mess of my kitchen walls </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># with smoothie. To add to my frustration, the warranty doesn&#x27;t cover the cost of cleaning </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># up my kitchen. Can you please help me out, friend?</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">service_reply = &quot;&quot;&quot;Hey there customer, \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">the warranty does not cover \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cleaning expenses for your kitchen \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">because it&#x27;s your fault that \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">you misused your blender \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">by forgetting to put the lid on before \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">starting the blender. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Tough luck! See ya!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">service_style_pirate = &quot;&quot;&quot;\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a polite tone \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">that speaks in English Pirate\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">service_messages = prompt_template.format_messages(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    style=service_style_pirate,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    text=service_reply)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">service_response = chat(service_messages)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(service_response.content)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Ahoy there, me hearty customer! I be sorry to inform ye that the warranty be not coverin&#x27; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># the expenses o&#x27; cleaning yer galley, as &#x27;tis yer own fault fer misusin&#x27; yer blender by </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># forgettin&#x27; to put the lid on afore startin&#x27; it. Aye, tough luck! Farewell and may the winds </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># be in yer favor!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="output-parsers">Output Parsers<a href="#output-parsers" class="hash-link" aria-label="Direct link to Output Parsers" title="Direct link to Output Parsers">​</a></h3>
<p>Let&#x27;s start with defining how we would like the LLM output to look like:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;gift&quot;: False,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;delivery_days&quot;: 5,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;price_value&quot;: &quot;pretty affordable!&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">customer_review = &quot;&quot;&quot;\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">This leaf blower is pretty amazing.  It has four settings:\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">candle blower, gentle breeze, windy city, and tornado. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">It arrived in two days, just in time for my wife&#x27;s \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">anniversary present. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">I think my wife liked it so much she was speechless. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">So far I&#x27;ve been the only one using it, and I&#x27;ve been \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">using it every other morning to clear the leaves on our lawn. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">It&#x27;s slightly more expensive than the other leaf blowers \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">out there, but I think it&#x27;s worth it for the extra features.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">review_template = &quot;&quot;&quot;\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">For the following text, extract the following information:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">gift: Was the item purchased as a gift for someone else? \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Answer True if yes, False if not or unknown.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">delivery_days: How many days did it take for the product \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">to arrive? If this information is not found, output -1.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">price_value: Extract any sentences about the value or price,\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">and output them as a comma separated Python list.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Format the output as JSON with the following keys:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">gift</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">delivery_days</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">price_value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">text: {text}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;&quot;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.prompts import ChatPromptTemplate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">prompt_template = ChatPromptTemplate.from_template(review_template)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(prompt_template)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">messages = prompt_template.format_messages(text=customer_review)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">chat = ChatOpenAI(temperature=0.0, model=llm_model)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">response = chat(messages)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(response.content)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#     &quot;gift&quot;: true,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#     &quot;delivery_days&quot;: 2,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#     &quot;price_value&quot;: [&quot;It&#x27;s slightly more expensive than the other leaf blowers out there, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#        but I think it&#x27;s worth it for the extra features.&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type(response.content)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># str</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># You will get an error by running this line of code because &#x27;gift&#x27; is not a dictionary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># &#x27;gift&#x27; is a string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">response.content.get(&#x27;gift&#x27;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="parse-the-llm-output-string-into-a-python-dictionary">Parse the LLM output string into a Python dictionary<a href="#parse-the-llm-output-string-into-a-python-dictionary" class="hash-link" aria-label="Direct link to Parse the LLM output string into a Python dictionary" title="Direct link to Parse the LLM output string into a Python dictionary">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.output_parsers import ResponseSchema</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.output_parsers import StructuredOutputParser</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>See <a href="https://api.python.langchain.com/en/latest/api_reference.html" target="_blank" rel="noopener noreferrer">langchain API Reference</a>
for details about <code>ResponseSchema</code> and <code>StructuredOutputParser</code>.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">gift_schema = ResponseSchema(name=&quot;gift&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                             description=&quot;Was the item purchased\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                             as a gift for someone else? \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                             Answer True if yes,\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                             False if not or unknown.&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">delivery_days_schema = ResponseSchema(name=&quot;delivery_days&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                      description=&quot;How many days\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                      did it take for the product\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                      to arrive? If this \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                      information is not found,\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                      output -1.&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">price_value_schema = ResponseSchema(name=&quot;price_value&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                    description=&quot;Extract any\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                    sentences about the value or \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                    price, and output them as a \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                    comma separated Python list.&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">response_schemas = [gift_schema, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    delivery_days_schema,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    price_value_schema]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">output_parser = StructuredOutputParser.from_response_schemas(response_schemas)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">format_instructions = output_parser.get_format_instructions()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(format_instructions)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">The output should be a markdown code snippet formatted in the following schema, including the leading and trailing &quot;\`\`\`json&quot; and &quot;\`\`\`&quot;:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">``json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;gift&quot;: string  // Was the item purchased as a gift for someone else? Answer True if yes, False if not or unknown.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;delivery_days&quot;: string  // How many days did it take for the product to arrive? If this information is not found, output -1.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;price_value&quot;: string  // Extract any sentences about the value or price, and output them as a comma separated Python list.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">``</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">review_template_2 = &quot;&quot;&quot;\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">For the following text, extract the following information:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">gift: Was the item purchased as a gift for someone else? \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Answer True if yes, False if not or unknown.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">delivery_days: How many days did it take for the product\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">to arrive? If this information is not found, output -1.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">price_value: Extract any sentences about the value or price,\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">and output them as a comma separated Python list.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">text: {text}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{format_instructions}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">prompt = ChatPromptTemplate.from_template(template=review_template_2)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">messages = prompt.format_messages(text=customer_review, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                  format_instructions=format_instructions)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(messages[0].content)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">response = chat(messages)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(response.content)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># ```json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#   &quot;gift&quot;: true,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#   &quot;delivery_days&quot;: &quot;2&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#   &quot;price_value&quot;: [&quot;It&#x27;s slightly more expensive than the other leaf blowers out there, but I think it&#x27;s worth it for the extra features.&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># ```</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">output_dict = output_parser.parse(response.content)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">output_dict</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># {&#x27;gift&#x27;: True,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#  &#x27;delivery_days&#x27;: &#x27;2&#x27;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#  &#x27;price_value&#x27;: [&quot;It&#x27;s slightly more expensive than the other leaf blowers out there, but I think it&#x27;s worth it for the extra features.&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type(output_dict)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># dict</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">output_dict.get(&#x27;delivery_days&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># &#x27;2&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><a href="https://ai.googleblog.com/2022/05/language-models-perform-reasoning-via.html" target="_blank" rel="noopener noreferrer">Language Models Perform Reasoning via Chain of Thought</a>.
This method enables models to decompose multi-step problems into intermediate steps.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="memory">Memory<a href="#memory" class="hash-link" aria-label="Direct link to Memory" title="Direct link to Memory">​</a></h2>
<p>Memory maintains Chain state, incorporating context from past runs.
See <a href="https://api.python.langchain.com/en/latest/api_reference.html#module-langchain.memory" target="_blank" rel="noopener noreferrer">langchain.memory</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="memory-types">Memory Types<a href="#memory-types" class="hash-link" aria-label="Direct link to Memory Types" title="Direct link to Memory Types">​</a></h3>
<ul>
<li><code>ConversationBufferMemory</code>: This memory allows for storing of messages and then extracts the messages in a variable.</li>
<li><code>ConversationBufferWindowMemory</code>: This memory keeps a list of the interactions of the comversation over time. It only uses the last K interactions.</li>
<li><code>ConversationTokenBufferMemory</code>: This memory keeps a buffer of recente interactions in memory, and uses token length rather than number of interactions to determine when to flush interactions.</li>
<li><code>ConversationSummaryMomery</code>: This memory creates a summary of the conversation over time.</li>
</ul>
<p>Additional Memory Types (supported by LangChain):</p>
<ul>
<li>Vectore data memory: Stores text (from conversation or elsewhere) in a vectore database and retrieves the most relevant blocks of text.</li>
<li>Entity memories: Usinh an LLM, it remembers details about specific entities.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup-1">Setup<a href="#setup-1" class="hash-link" aria-label="Direct link to Setup" title="Direct link to Setup">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from dotenv import load_dotenv, find_dotenv</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">_ = load_dotenv(find_dotenv()) # read local .env file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import warnings</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">warnings.filterwarnings(&#x27;ignore&#x27;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># account for deprecation of LLM model</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import datetime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Get the current date</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">current_date = datetime.datetime.now().date()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Define the date after which the model should be set to &quot;gpt-3.5-turbo&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">target_date = datetime.date(2024, 6, 12)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Set the model variable based on the current date</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if current_date &gt; target_date:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm_model = &quot;gpt-3.5-turbo&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm_model = &quot;gpt-3.5-turbo-0301&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="conversationbuffermemory">ConversationBufferMemory<a href="#conversationbuffermemory" class="hash-link" aria-label="Direct link to ConversationBufferMemory" title="Direct link to ConversationBufferMemory">​</a></h3>
<p><code>ConversationChain</code> is a chain to have a conversation and load context from memory.
<code>ConversationBufferMemory</code> is a buffer for storing conversation memory.
See <a href="https://api.python.langchain.com/en/latest/api_reference.html" target="_blank" rel="noopener noreferrer">langchain API Reference</a>
for more.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chat_models import ChatOpenAI</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chains import ConversationChain</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.memory import ConversationBufferMemory</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">llm = ChatOpenAI(temperature=0.0, model=llm_model)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory = ConversationBufferMemory()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">conversation = ConversationChain(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm=llm, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    memory = memory,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    verbose=True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">conversation.predict(input=&quot;Hi, my name is Andrew&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">conversation.predict(input=&quot;What is 1+1?&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">conversation.predict(input=&quot;What is my name?&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(memory.buffer)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Human: Hi, my name is Andrew</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">AI: Hello Andrew, it&#x27;s nice to meet you. My name is AI. How can I assist you today?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Human: What is 1+1?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">AI: The answer to 1+1 is 2.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Human: What is my name?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">AI: Your name is Andrew, as you mentioned earlier.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory.load_memory_variables({})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{&#x27;history&#x27;: &quot;Human: Hi, my name is Andrew\nAI: Hello Andrew, it&#x27;s nice to meet you. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">My name is AI. How can I assist you today?\nHuman: What is 1+1?\nAI: The answer to </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1+1 is 2.\nHuman: What is my name?\nAI: Your name is Andrew, as you mentioned </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">earlier.&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory = ConversationBufferMemory()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory.save_context({&quot;input&quot;: &quot;Hi&quot;}, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    {&quot;output&quot;: &quot;What&#x27;s up&quot;})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(memory.buffer)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Human: Hi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">AI: What&#x27;s up</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory.load_memory_variables({})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{&#x27;history&#x27;: &quot;Human: Hi\nAI: What&#x27;s up&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory.save_context({&quot;input&quot;: &quot;Not much, just hanging&quot;}, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    {&quot;output&quot;: &quot;Cool&quot;})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory.load_memory_variables({})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{&#x27;history&#x27;: &quot;Human: Hi\nAI: What&#x27;s up\nHuman: Not much, just hanging\nAI: Cool&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="conversationbufferwindowmemory">ConversationBufferWindowMemory<a href="#conversationbufferwindowmemory" class="hash-link" aria-label="Direct link to ConversationBufferWindowMemory" title="Direct link to ConversationBufferWindowMemory">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.memory import ConversationBufferWindowMemory</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory = ConversationBufferWindowMemory(k=1)               </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory.save_context({&quot;input&quot;: &quot;Hi&quot;},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    {&quot;output&quot;: &quot;What&#x27;s up&quot;})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory.save_context({&quot;input&quot;: &quot;Not much, just hanging&quot;},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    {&quot;output&quot;: &quot;Cool&quot;})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">​</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory.load_memory_variables({})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># {&#x27;history&#x27;: &#x27;Human: Not much, just hanging\nAI: Cool&#x27;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>ConversationBufferWindowMemory</code> is a buffer for storing conversation memory
inside a limited size window. Here, <code>k=1</code> is the number of messages to store in buffer.
See <a href="https://api.python.langchain.com/en/latest/api_reference.html" target="_blank" rel="noopener noreferrer">langchain API Reference</a>
for more.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">llm = ChatOpenAI(temperature=0.0, model=llm_model)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory = ConversationBufferWindowMemory(k=1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">conversation = ConversationChain(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm=llm, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    memory = memory,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    verbose=False</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">conversation.predict(input=&quot;Hi, my name is Andrew&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># &quot;Hello Andrew, it&#x27;s nice to meet you. My name is AI. How can I assist you today?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">conversation.predict(input=&quot;What is 1+1?&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># &#x27;The answer to 1+1 is 2.&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">conversation.predict(input=&quot;What is my name?&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># &quot;I&#x27;m sorry, I don&#x27;t have access to that information. Could you please tell me your name?&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="conversationtokenbuffermemory">ConversationTokenBufferMemory<a href="#conversationtokenbuffermemory" class="hash-link" aria-label="Direct link to ConversationTokenBufferMemory" title="Direct link to ConversationTokenBufferMemory">​</a></h3>
<p><code>ConversationTokenBufferMemory</code> is a conversation chat memory with token limit.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">!pip install tiktoken</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.memory import ConversationTokenBufferMemory</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.llms import OpenAI</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">llm = ChatOpenAI(temperature=0.0, model=llm_model)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory = ConversationTokenBufferMemory(llm=llm, max_token_limit=50)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory.save_context({&quot;input&quot;: &quot;AI is what?!&quot;},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    {&quot;output&quot;: &quot;Amazing!&quot;})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory.save_context({&quot;input&quot;: &quot;Backpropagation is what?&quot;},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    {&quot;output&quot;: &quot;Beautiful!&quot;})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory.save_context({&quot;input&quot;: &quot;Chatbots are what?&quot;}, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    {&quot;output&quot;: &quot;Charming!&quot;})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory.load_memory_variables({})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{&#x27;history&#x27;: &#x27;AI: Amazing!\nHuman: Backpropagation is what?\nAI: Beautiful!\nHuman: Chatbots are what?\nAI: Charming!&#x27;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="conversationsummarymemory">ConversationSummaryMemory<a href="#conversationsummarymemory" class="hash-link" aria-label="Direct link to ConversationSummaryMemory" title="Direct link to ConversationSummaryMemory">​</a></h3>
<p><code>ConversationSummaryMemory</code> is a conversation summarizer to chat memory.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.memory import ConversationSummaryBufferMemory</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># create a long string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">schedule = &quot;There is a meeting at 8am with your product team. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">You will need your powerpoint presentation prepared. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">9am-12pm have time to work on your LangChain \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">project which will go quickly because Langchain is such a powerful tool. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">At Noon, lunch at the italian resturant with a customer who is driving \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from over an hour away to meet you to understand the latest in AI. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Be sure to bring your laptop to show the latest LLM demo.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory = ConversationSummaryBufferMemory(llm=llm, max_token_limit=100)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory.save_context({&quot;input&quot;: &quot;Hello&quot;}, {&quot;output&quot;: &quot;What&#x27;s up&quot;})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory.save_context({&quot;input&quot;: &quot;Not much, just hanging&quot;},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    {&quot;output&quot;: &quot;Cool&quot;})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory.save_context({&quot;input&quot;: &quot;What is on the schedule today?&quot;}, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    {&quot;output&quot;: f&quot;{schedule}&quot;})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory.load_memory_variables({})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{&#x27;history&#x27;: &quot;System: The human and AI engage in small talk before discussing the day&#x27;s schedule. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">The AI informs the human of a morning meeting with the product team, time to work on the </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LangChain project, and a lunch meeting with a customer interested in the latest AI </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">developments.&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">conversation = ConversationChain(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm=llm, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    memory = memory,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    verbose=True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">conversation.predict(input=&quot;What would be a good demo to show?&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Entering new ConversationChain chain...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Prompt after formatting:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">The following is a friendly conversation between a human and an AI. The AI is talkative </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">and provides lots of specific details from its context. If the AI does not know the answer </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">to a question, it truthfully says it does not know.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Current conversation:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">System: The human and AI engage in small talk before discussing the day&#x27;s schedule. The AI </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">informs the human of a morning meeting with the product team, time to work on the LangChain </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">project, and a lunch meeting with a customer interested in the latest AI developments.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Human: What would be a good demo to show?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">AI:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Finished chain.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Based on the customer&#x27;s interest in AI developments, I would suggest showcasing our latest </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">natural language processing capabilities. We could demonstrate how our AI can accurately </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">understand and respond to complex language queries, and even provide personalized recommendations </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">based on the user&#x27;s preferences. Additionally, we could highlight our AI&#x27;s ability to learn </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">and adapt over time, making it a valuable tool for businesses looking to improve their </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">customer experience.&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory.load_memory_variables({})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{&#x27;history&#x27;: &quot;System: The human and AI engage in small talk before discussing the day&#x27;s schedule. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">The AI informs the human of a morning meeting with the product team, time to work on the </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LangChain project, and a lunch meeting with a customer interested in the latest AI developments. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">The human asks what would be a good demo to show.\nAI: Based on the customer&#x27;s interest in AI </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">developments, I would suggest showcasing our latest natural language processing capabilities. We</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">could demonstrate how our AI can accurately understand and respond to complex language queries, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">and even provide personalized recommendations based on the user&#x27;s preferences. Additionally, we </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">could highlight our AI&#x27;s ability to learn and adapt over time, making it a valuable tool for </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">businesses looking to improve their customer experience.&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="chains">Chains<a href="#chains" class="hash-link" aria-label="Direct link to Chains" title="Direct link to Chains">​</a></h2>
<blockquote>
<p>2023-08-29</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup-2">Setup<a href="#setup-2" class="hash-link" aria-label="Direct link to Setup" title="Direct link to Setup">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import warnings</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">warnings.filterwarnings(&#x27;ignore&#x27;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from dotenv import load_dotenv, find_dotenv</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">_ = load_dotenv(find_dotenv()) # read local .env file</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># account for deprecation of LLM model</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import datetime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Get the current date</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">current_date = datetime.datetime.now().date()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Define the date after which the model should be set to &quot;gpt-3.5-turbo&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">target_date = datetime.date(2024, 6, 12)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Set the model variable based on the current date</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if current_date &gt; target_date:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm_model = &quot;gpt-3.5-turbo&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm_model = &quot;gpt-3.5-turbo-0301&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import pandas as pd</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">df = pd.read_csv(&#x27;Data.csv&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(df.head())</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   Product                                             Review</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0     Queen Size Sheet Set  I ordered a king size set. My only criticism w...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1   Waterproof Phone Pouch  I loved the waterproof sac, although the openi...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2      Luxury Air Mattress  This mattress had a small hole in the top of i...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3           Pillows Insert  This is the best throw pillow fillers on Amazo...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">4  Milk Frother Handheld\n   I loved this product. But they only seem to l...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="llmchain">LLMChain<a href="#llmchain" class="hash-link" aria-label="Direct link to LLMChain" title="Direct link to LLMChain">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chat_models import ChatOpenAI</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.prompts import ChatPromptTemplate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chains import LLMChain</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">llm = ChatOpenAI(temperature=0.9, model=llm_model)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">prompt = ChatPromptTemplate.from_template(&quot;What is the best name to describe a company that makes \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            {product}?&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">chain = LLMChain(llm=llm, prompt=prompt)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">product = &quot;Queen Size Sheet Set&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">chain.run(product)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>A higher temperature value typically makes the output more diverse and creative but might also
increase its likelihood of straying from the context. Conversely, a lower temperature value makes
the AI&#x27;s responses more focused and deterministic, sticking closely to the most likely prediction.</p>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;&quot;Royal Linens&quot; would be a fitting name for a company that makes queen size sheet sets, as it </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">implies luxury and high quality.&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="simplesequentialchain">SimpleSequentialChain<a href="#simplesequentialchain" class="hash-link" aria-label="Direct link to SimpleSequentialChain" title="Direct link to SimpleSequentialChain">​</a></h3>
<p>Sequential chains allow you to connect multiple chains and compose them into pipelines that execute
some specific scenario.
See <a href="https://python.langchain.com/docs/modules/chains/foundational/sequential_chains" target="_blank" rel="noopener noreferrer">Sequential</a> for more information.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chains import SimpleSequentialChain</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># prompt template 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">first_prompt = ChatPromptTemplate.from_template(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;What is the best name to describe a company that makes {product}?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Chain 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">chain_one = LLMChain(llm=llm, prompt=first_prompt)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># prompt template 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">second_prompt = ChatPromptTemplate.from_template(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Write a 20 words description for the following company:{company_name}&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># chain 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">chain_two = LLMChain(llm=llm, prompt=second_prompt)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">overall_simple_chain = SimpleSequentialChain(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        chains=[chain_one, chain_two], verbose=True)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="sequentialchain">SequentialChain<a href="#sequentialchain" class="hash-link" aria-label="Direct link to SequentialChain" title="Direct link to SequentialChain">​</a></h4>
<p>The simple sequential chain works well when there&#x27;s only a single input and a single output.
But what about when we have multiple inputs and outputs?</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chains import SequentialChain</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">llm = ChatOpenAI(temperature=0.9, model=llm_model)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># prompt template 1: translate to english</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">first_prompt = ChatPromptTemplate.from_template(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Translate the following review to english:&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;\n\n{Review}&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># chain 1: input= Review and output= English_Review</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">chain_one = LLMChain(llm=llm, prompt=first_prompt, output_key=&quot;English_Review&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># prompt template 2: summarize</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">second_prompt = ChatPromptTemplate.from_template(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Can you summarize the following review in 1 sentence:&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;\n\n{English_Review}&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># chain 2: input= English_Review and output= summary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">chain_two = LLMChain(llm=llm, prompt=second_prompt, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                     output_key=&quot;summary&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    )                  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># prompt template 3: translate to english</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">third_prompt = ChatPromptTemplate.from_template(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;What language is the following review:\n\n{Review}&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)ùùùù</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># chain 3: input= Review and output= language</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">chain_three = LLMChain(llm=llm, prompt=third_prompt,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                       output_key=&quot;language&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                      )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># prompt template 4: follow up message</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fourth_prompt = ChatPromptTemplate.from_template(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Write a follow up response to the following &quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;summary in the specified language:&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;\n\nSummary: {summary}\n\nLanguage: {language}&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># chain 4: input= summary, language and output= followup_message</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">chain_four = LLMChain(llm=llm, prompt=fourth_prompt,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                      output_key=&quot;followup_message&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                     )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># overall_chain: input= Review </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># and output= English_Review,summary, followup_message</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">overall_chain = SequentialChain(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chains=[chain_one, chain_two, chain_three, chain_four],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    input_variables=[&quot;Review&quot;],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    output_variables=[&quot;English_Review&quot;, &quot;summary&quot;, &quot;followup_message&quot;],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    verbose=True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">review = df.Review[5]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">overall_chain(review)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Entering new SequentialChain chain...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Finished chain.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{&#x27;Review&#x27;: &quot;Je trouve le goût médiocre. La mousse ne tient pas, c&#x27;est bizarre. J&#x27;achète les mêmes dans le commerce et </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">le goût est bien meilleur...\nVieux lot ou contrefaçon !?&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> &#x27;English_Review&#x27;: &quot;I find the taste mediocre. The foam doesn&#x27;t hold, it&#x27;s weird. I buy the same ones in stores and the </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> taste is much better... Old batch or counterfeit!?&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> &#x27;summary&#x27;: &quot;The reviewer is disappointed with the taste and foam of the product and questions if it&#x27;s an old batch or </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> counterfeit.&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> &#x27;followup_message&#x27;: &#x27;Réponse : Nous sommes désolés que vous ayez été déçu par le goût et la mousse de notre produit. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Nous vous assurons que nous prenons toutes les mesures nécessaires pour maintenir la qualité constante de nos produits. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Si vous pensez que vous avez reçu un lot périmé ou contrefait, veuillez nous contacter immédiatement pour que nous </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> puissions enquêter sur la situation et prendre les mesures appropriées. Nous apprécions vos commentaires car ils nous </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> aident à améliorer constamment notre produit. Merci.&#x27;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="router-chain">Router Chain<a href="#router-chain" class="hash-link" aria-label="Direct link to Router Chain" title="Direct link to Router Chain">​</a></h3>
<p>In this section, we use the RouterChain paradigm to create a chain that dynamically selects the next chain to use for a
given input. See <a href="https://python.langchain.com/docs/modules/chains/foundational/router" target="_blank" rel="noopener noreferrer">Router</a> for more information.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">physics_template = &quot;&quot;&quot;You are a very smart physics professor. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">You are great at answering questions about physics in a concise\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">and easy to understand manner. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">When you don&#x27;t know the answer to a question you admit\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">that you don&#x27;t know.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Here is a question:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{input}&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">math_template = &quot;&quot;&quot;You are a very good mathematician. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">You are great at answering math questions. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">You are so good because you are able to break down \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">hard problems into their component parts, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">answer the component parts, and then put them together\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">to answer the broader question.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Here is a question:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{input}&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">history_template = &quot;&quot;&quot;You are a very good historian. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">You have an excellent knowledge of and understanding of people,\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">events and contexts from a range of historical periods. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">You have the ability to think, reflect, debate, discuss and \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">evaluate the past. You have a respect for historical evidence\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">and the ability to make use of it to support your explanations \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">and judgements.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Here is a question:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{input}&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">computerscience_template = &quot;&quot;&quot; You are a successful computer scientist.\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">You have a passion for creativity, collaboration,\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">forward-thinking, confidence, strong problem-solving capabilities,\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">understanding of theories and algorithms, and excellent communication \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">skills. You are great at answering coding questions. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">You are so good because you know how to solve a problem by \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">describing the solution in imperative steps \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">that a machine can easily interpret and you know how to \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">choose a solution that has a good balance between \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">time complexity and space complexity. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Here is a question:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{input}&quot;&quot;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">prompt_infos = [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;name&quot;: &quot;physics&quot;, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;description&quot;: &quot;Good for answering questions about physics&quot;, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;prompt_template&quot;: physics_template</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;name&quot;: &quot;math&quot;, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;description&quot;: &quot;Good for answering math questions&quot;, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;prompt_template&quot;: math_template</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;name&quot;: &quot;History&quot;, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;description&quot;: &quot;Good for answering history questions&quot;, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;prompt_template&quot;: history_template</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;name&quot;: &quot;computer science&quot;, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;description&quot;: &quot;Good for answering computer science questions&quot;, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;prompt_template&quot;: computerscience_template</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chains.router import MultiPromptChain</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chains.router.llm_router import LLMRouterChain,RouterOutputParser</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.prompts import PromptTemplate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">llm = ChatOpenAI(temperature=0, model=llm_model)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">destination_chains = {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">for p_info in prompt_infos:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name = p_info[&quot;name&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    prompt_template = p_info[&quot;prompt_template&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    prompt = ChatPromptTemplate.from_template(template=prompt_template)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chain = LLMChain(llm=llm, prompt=prompt)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    destination_chains[name] = chain  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">destinations = [f&quot;{p[&#x27;name&#x27;]}: {p[&#x27;description&#x27;]}&quot; for p in prompt_infos]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">destinations_str = &quot;\n&quot;.join(destinations)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">default_prompt = ChatPromptTemplate.from_template(&quot;{input}&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">default_chain = LLMChain(llm=llm, prompt=default_prompt)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">MULTI_PROMPT_ROUTER_TEMPLATE = &quot;&quot;&quot;Given a raw text input to a \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">language model select the model prompt best suited for the input. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">You will be given the names of the available prompts and a \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">description of what the prompt is best suited for. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">You may also revise the original input if you think that revising\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">it will ultimately lead to a better response from the language model.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;&lt; FORMATTING &gt;&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Return a markdown code snippet with a JSON object formatted to look like:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">``json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{{{{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;destination&quot;: string \ name of the prompt to use or &quot;DEFAULT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;next_inputs&quot;: string \ a potentially modified version of the original input</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}}}}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">``</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">REMEMBER: &quot;destination&quot; MUST be one of the candidate prompt \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">names specified below OR it can be &quot;DEFAULT&quot; if the input is not\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">well suited for any of the candidate prompts.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">REMEMBER: &quot;next_inputs&quot; can just be the original input \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if you don&#x27;t think any modifications are needed.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;&lt; CANDIDATE PROMPTS &gt;&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{destinations}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;&lt; INPUT &gt;&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{{input}}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;&lt; OUTPUT (remember to include the ```json)&gt;&gt;&quot;&quot;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">router_template = MULTI_PROMPT_ROUTER_TEMPLATE.format(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    destinations=destinations_str</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">router_prompt = PromptTemplate(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    template=router_template,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    input_variables=[&quot;input&quot;],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    output_parser=RouterOutputParser(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">router_chain = LLMRouterChain.from_llm(llm, router_prompt)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">chain = MultiPromptChain(router_chain=router_chain, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                         destination_chains=destination_chains, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                         default_chain=default_chain, verbose=True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">chain.run(&quot;What is black body radiation?&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Entering new MultiPromptChain chain...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">physics: {&#x27;input&#x27;: &#x27;What is black body radiation?&#x27;}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Finished chain.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Black body radiation refers to the electromagnetic radiation emitted by a perfect black body, which is an object that </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">absorbs all radiation that falls on it and emits radiation at all wavelengths. The radiation emitted by a black body </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">depends only on its temperature and follows a specific distribution known as Planck&#x27;s law. This type of radiation is </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">important in understanding the behavior of stars, as well as in the development of technologies such as incandescent </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">light bulbs and infrared cameras.&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">chain.run(&quot;what is 2 + 2&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Entering new MultiPromptChain chain...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">math: {&#x27;input&#x27;: &#x27;what is 2 + 2&#x27;}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Finished chain.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;As an AI language model, I can answer this question easily. The answer to 2 + 2 is 4.&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="questions-and-answer">Questions and Answer<a href="#questions-and-answer" class="hash-link" aria-label="Direct link to Questions and Answer" title="Direct link to Questions and Answer">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup-3">Setup<a href="#setup-3" class="hash-link" aria-label="Direct link to Setup" title="Direct link to Setup">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">!pip install --upgrade langchain</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">!pip install docarray</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from dotenv import load_dotenv, find_dotenv</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">_ = load_dotenv(find_dotenv()) # read local .env file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># account for deprecation of LLM model</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import datetime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Get the current date</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">current_date = datetime.datetime.now().date()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Define the date after which the model should be set to &quot;gpt-3.5-turbo&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">target_date = datetime.date(2024, 6, 12)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Set the model variable based on the current date</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if current_date &gt; target_date:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm_model = &quot;gpt-3.5-turbo&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm_model = &quot;gpt-3.5-turbo-0301&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chains import RetrievalQA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chat_models import ChatOpenAI</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.document_loaders import CSVLoader</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.vectorstores import DocArrayInMemorySearch</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from IPython.display import display, Markdown</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">file = &#x27;OutdoorClothingCatalog_1000.csv&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">loader = CSVLoader(file_path=file)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import pandas as pd</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">df = pd.read_csv(file)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(df.head()) </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">   Unnamed: 0                                               name   </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0           0                           Women&#x27;s Campside Oxfords  \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1           1           Recycled Waterhog Dog Mat, Chevron Weave   </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2           2  Infant and Toddler Girls&#x27; Coastal Chill Swimsu...   </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3           3         Refresh Swimwear, V-Neck Tankini Contrasts   </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">4           4                             EcoFlex 3L Storm Pants   </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                         description  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0  This ultracomfortable lace-to-toe Oxford boast...  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1  Protect your floors from spills and splashing ...  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2  She&#x27;ll love the bright colors, ruffles and exc...  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3  Whether you&#x27;re going for a swim or heading out...  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">4  Our new TEK O2 technology makes our four-seaso...  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.indexes import VectorstoreIndexCreator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">index = VectorstoreIndexCreator(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    vectorstore_cls=DocArrayInMemorySearch</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">).from_loaders([loader])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">query =&quot;Please list all your shirts with sun protection \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">in a table in markdown and summarize each one.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">response = index.query(query)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># display(Markdown(response))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(response)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">| Name | Description |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| --- | --- |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| Men&#x27;s Tropical Plaid Short-Sleeve Shirt | UPF 50+ rated, 100% polyester, wrinkle-resistant, front and back cape venting, two front bellows pockets |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| Men&#x27;s Plaid Tropic Shirt, Short-Sleeve | UPF 50+ rated, 52% polyester and 48% nylon, machine washable and dryable, front and back cape venting, two front bellows pockets |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| Men&#x27;s TropicVibe Shirt, Short-Sleeve | UPF 50+ rated, 71% Nylon, 29% Polyester, 100% Polyester knit mesh, wrinkle resistant, front and back cape venting, two front bellows pockets |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| Sun Shield Shirt by | UPF 50+ rated, 78% nylon, 22% Lycra Xtra Life fiber, wicks moisture, fits comfortably over swimsuit, abrasion resistant |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">All four shirts provide UPF 50+ sun protection, blocking 98% of the sun&#x27;s harmful rays. The Men&#x27;s Tropical Plaid Short-Sleeve Shirt is made of 100% polyester and is wrinkle-resistant. The Men&#x27;s Plaid Trop</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>LLMs on Documents function by inspecting limited portions of text, typically a few thousand words at a time. This is where embeddings and vector stores play a crucial role.</p>
<p>An embedding vector captures the essence and meaning of content. Similar content will yield similar vectors in tests. A vector database serves as a repository for these vector representations. We establish a vector database that gets populated with text segments extracted from incoming documents.</p>
<p>When dealing with a substantial incoming document, our initial step involves dividing it into smaller segments. This approach generates text portions smaller than the original document, a practical strategy since the entire document might be too extensive for the language model to process in one go. Our aim is to create these compact portions to ensure that only the most pertinent segments are presented to the language model. Subsequently, we generate an embedding for each of these sections and store them within the vector database. This constitutes the process of index creation.</p>
<p>With the index in place, we can utilize it in real-time to identify text segments most relevant to an incoming query. Upon receiving a query, we generate an embedding corresponding to that query. This embedding is then compared against all vectors stored in the vector database, from which we select the top n most similar vectors. These selected vectors are returned, and we can present them to the language model through a prompt to obtain a final response. Thus, the aforementioned sequence of actions is accomplished with just a few lines of code.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-by-step">Step By Step<a href="#step-by-step" class="hash-link" aria-label="Direct link to Step By Step" title="Direct link to Step By Step">​</a></h3>
<p>See <a href="https://python.langchain.com/docs/integrations/document_loaders/csv" target="_blank" rel="noopener noreferrer">CSV</a>.</p>
<p>Read the file.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.document_loaders import CSVLoader</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">loader = CSVLoader(file_path=file)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs = loader.load()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(docs[0])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Create embeddings.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.embeddings import OpenAIEmbeddings</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">embeddings = OpenAIEmbeddings()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">embed = embeddings.embed_query(&quot;Hi my name is Harrison&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(len(embed))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 1536</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(embed[:5])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># [-0.021913960576057434, 0.006774206645786762, -0.018190348520874977, -0.039148248732089996, -0.014089343138039112]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Load embeddings into a vector store.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">db = DocArrayInMemorySearch.from_documents(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docs, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    embeddings</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Use this vectore store.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">query = &quot;Please suggest a shirt with sunblocking&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs = db.similarity_search(query)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(len(docs))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(docs[0])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To question our own documents, we need to create a retreiver from this
vector store.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">retriever = db.as_retriever()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">llm = ChatOpenAI(temperature=0.0, model=llm_model)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">qdocs = &quot;&quot;.join([docs[i].page_content for i in range(len(docs))])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">response = llm.call_as_llm(f&quot;{qdocs} Question: Please list all your \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">shirts with sun protection in a table in markdown and summarize each one.&quot;) </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># display(Markdown(response))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(response)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>All of those steps can be encapsulated with the LangChain chain.
We will create a RetreivalQA Chain. See <a href="https://python.langchain.com/docs/use_cases/question_answering/how_to/vector_db_qa" target="_blank" rel="noopener noreferrer">QA using a Retriever</a>
for more information.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">qa_stuff = RetrievalQA.from_chain_type(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm=llm, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chain_type=&quot;stuff&quot;, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    retriever=retriever, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    verbose=True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">query =  &quot;Please list all your shirts with sun protection in a table \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">in markdown and summarize each one.&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">response = qa_stuff.run(query)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># display(Markdown(response))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(response)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Stuffing: Simplest method, stuffing all related data into the prompt as context; implemented as StuffDocumentsChain.</li>
<li>Map Reduce: Runs an initial prompt on each chunk of data, then combines the outputs; implemented as MapReduceDocumentsChain.</li>
<li>Refine: Refines output based on new documents; calls are not independent and cannot be parallelized like MapReduceDocumentsChain.</li>
<li>Map-Rerank: Runs an initial prompt on each chunk of data with a score for certainty, ranks responses, and returns the highest score.</li>
</ul>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">response = index.query(query, llm=llm)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">index = VectorstoreIndexCreator(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    vectorstore_cls=DocArrayInMemorySearch,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    embedding=embeddings,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">).from_loaders([loader])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="evaluation">Evaluation<a href="#evaluation" class="hash-link" aria-label="Direct link to Evaluation" title="Direct link to Evaluation">​</a></h2>
<blockquote>
<p>2023-08-30</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup-4">Setup<a href="#setup-4" class="hash-link" aria-label="Direct link to Setup" title="Direct link to Setup">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from dotenv import load_dotenv, find_dotenv</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">_ = load_dotenv(find_dotenv()) # read local .env file</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># account for deprecation of LLM model</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import datetime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Get the current date</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">current_date = datetime.datetime.now().date()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Define the date after which the model should be set to &quot;gpt-3.5-turbo&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">target_date = datetime.date(2024, 6, 12)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Set the model variable based on the current date</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if current_date &gt; target_date:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm_model = &quot;gpt-3.5-turbo&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm_model = &quot;gpt-3.5-turbo-0301&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-our-qanda-application">Create our QandA application<a href="#create-our-qanda-application" class="hash-link" aria-label="Direct link to Create our QandA application" title="Direct link to Create our QandA application">​</a></h3>
<p>Import necessary modules and classes for setting up a question-and-answer (Q&amp;A) application using the Langchain library.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chains import RetrievalQA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chat_models import ChatOpenAI</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.document_loaders import CSVLoader</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.indexes import VectorstoreIndexCreator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.vectorstores import DocArrayInMemorySearch</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>A CSV file named <code>OutdoorClothingCatalog_1000.csv</code> is loaded using the CSVLoader class.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">file = &#x27;OutdoorClothingCatalog_1000.csv&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">loader = CSVLoader(file_path=file)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">data = loader.load()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>An index is created using the <a href="https://api.python.langchain.com/en/latest/indexes/langchain.indexes.vectorstore.VectorstoreIndexCreator.html" target="_blank" rel="noopener noreferrer">VectorstoreIndexCreator</a> class.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">index = VectorstoreIndexCreator(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    vectorstore_cls=DocArrayInMemorySearch</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">).from_loaders([loader])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>A Q&amp;A system is set up using the <code>ChatOpenAI</code> and <code>RetrievalQA</code> classes. An instance of <code>ChatOpenAI</code> is created with a temperature
of 0.0 and a model called <code>llm_model</code>. The <code>RetrievalQA.from_chain_type</code> function is used to create a Q&amp;A system with a
language model (LLM), a chain type named &quot;stuff&quot;, a retriever based on the previously created index,
and additional settings like verbosity and document separator.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">llm = ChatOpenAI(temperature = 0.0, model=llm_model)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">qa = RetrievalQA.from_chain_type(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm=llm, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chain_type=&quot;stuff&quot;, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    retriever=index.vectorstore.as_retriever(), </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    verbose=True,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chain_type_kwargs = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;document_separator&quot;: &quot;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="coming-up-with-test-datapoints">Coming up with test datapoints<a href="#coming-up-with-test-datapoints" class="hash-link" aria-label="Direct link to Coming up with test datapoints" title="Direct link to Coming up with test datapoints">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">data[10]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Document(page_content=&quot;: 10\nname: Cozy Comfort Pullover Set, Stripe\ndescription: Perfect for lounging, this striped </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">knit set lives up to its name. We used ultrasoft fabric and an easy design that&#x27;s as comfortable at bedtime as it is </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">when we have to make a quick run out.\n\nSize &amp; Fit\n- Pants are Favorite Fit: Sits lower on the waist.\n- Relaxed Fit: </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Our most generous fit sits farthest from the body.\n\nFabric &amp; Care\n- In the softest blend of 63% polyester, 35% rayon </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">and 2% spandex.\n\nAdditional Features\n- Relaxed fit top with raglan sleeves and rounded hem.\n- Pull-on pants have a </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">wide elastic waistband and drawstring, side pockets and a modern slim leg.\n\nImported.&quot;, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata={&#x27;source&#x27;: &#x27;OutdoorClothingCatalog_1000.csv&#x27;, &#x27;row&#x27;: 10})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">data[11]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Document(page_content=&#x27;: 11\nname: Ultra-Lofty 850 Stretch Down Hooded Jacket\ndescription: This technical stretch down </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">jacket from our DownTek collection is sure to keep you warm and comfortable with its full-stretch construction providing </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">exceptional range of motion. With a slightly fitted style that falls at the hip and best with a midweight layer, this </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">jacket is suitable for light activity up to 20° and moderate activity up to -30°. The soft and durable 100% polyester </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">shell offers complete windproof protection and is insulated with warm, lofty goose down. Other features include welded </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">baffles for a no-stitch construction and excellent stretch, an adjustable hood, an interior media port and mesh stash </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pocket and a hem drawcord. Machine wash and dry. Imported.&#x27;, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata={&#x27;source&#x27;: &#x27;OutdoorClothingCatalog_1000.csv&#x27;, &#x27;row&#x27;: 11})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="hard-coded-examples">Hard-coded examples<a href="#hard-coded-examples" class="hash-link" aria-label="Direct link to Hard-coded examples" title="Direct link to Hard-coded examples">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">examples = [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;query&quot;: &quot;Do the Cozy Comfort Pullover Set have side pockets?&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;answer&quot;: &quot;Yes&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;query&quot;: &quot;What collection is the Ultra-Lofty 850 Stretch Down Hooded Jacket from?&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;answer&quot;: &quot;The DownTek collection&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="llm-generated-examples">LLM-Generated examples<a href="#llm-generated-examples" class="hash-link" aria-label="Direct link to LLM-Generated examples" title="Direct link to LLM-Generated examples">​</a></h3>
<p>LLM Chain for generating examples for question answering.
See <a href="https://api.python.langchain.com/en/latest/evaluation/langchain.evaluation.qa.generate_chain.QAGenerateChain.html" target="_blank" rel="noopener noreferrer"></a>.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.evaluation.qa import QAGenerateChain</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">example_gen_chain = QAGenerateChain.from_llm(ChatOpenAI(model=llm_model))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># the warning below can be safely ignored</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">new_examples = example_gen_chain.apply_and_parse(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    [{&quot;doc&quot;: t} for t in data[:5]]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">new_examples[0]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{&#x27;query&#x27;: &quot;What is the approximate weight of the Women&#x27;s Campside Oxfords per pair?&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> &#x27;answer&#x27;: &quot;The approximate weight of the Women&#x27;s Campside Oxfords per pair is 1 lb. 1 oz.&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">data[0]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Document(page_content=&quot;: 0\nname: Women&#x27;s Campside Oxfords\ndescription: This ultracomfortable </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">lace-to-toe Oxford boasts a super-soft canvas, thick cushioning, and quality construction for a </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">broken-in feel from the first time you put them on. \n\nSize &amp; Fit: Order regular shoe size. For </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">half sizes not offered, order up to next whole size. \n\nSpecs: Approx. weight: 1 lb.1 oz. per pair. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">\n\nConstruction: Soft canvas material for a broken-in feel and look. Comfortable EVA innersole </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">with Cleansport NXT® antimicrobial odor control. Vintage hunt, fish and camping motif on innersole. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Moderate arch contour of innersole. EVA foam midsole for cushioning and support. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Chain-tread-inspired molded rubber outsole with modified chain-tread pattern. Imported. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">\n\nQuestions? Please contact us for any inquiries.&quot;, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata={&#x27;source&#x27;: &#x27;OutdoorClothingCatalog_1000.csv&#x27;, &#x27;row&#x27;: 0})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="combine-examples">Combine examples<a href="#combine-examples" class="hash-link" aria-label="Direct link to Combine examples" title="Direct link to Combine examples">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">examples += new_examples</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">qa.run(examples[0][&quot;query&quot;])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="manual-evaluation">Manual Evaluation<a href="#manual-evaluation" class="hash-link" aria-label="Direct link to Manual Evaluation" title="Direct link to Manual Evaluation">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import langchain</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">langchain.debug = True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">qa.run(examples[0][&quot;query&quot;])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Turn off the debug mode</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">langchain.debug = False</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="llm-assisted-evaluation">LLM assisted evaluation<a href="#llm-assisted-evaluation" class="hash-link" aria-label="Direct link to LLM assisted evaluation" title="Direct link to LLM assisted evaluation">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">predictions = qa.apply(examples)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.evaluation.qa import QAEvalChain</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">llm = ChatOpenAI(temperature=0, model=llm_model)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">eval_chain = QAEvalChain.from_llm(llm)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">graded_outputs = eval_chain.evaluate(examples, predictions)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">for i, eg in enumerate(examples):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    print(f&quot;Example {i}:&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    print(&quot;Question: &quot; + predictions[i][&#x27;query&#x27;])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    print(&quot;Real Answer: &quot; + predictions[i][&#x27;answer&#x27;])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    print(&quot;Predicted Answer: &quot; + predictions[i][&#x27;result&#x27;])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    print(&quot;Predicted Grade: &quot; + graded_outputs[i][&#x27;text&#x27;])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    print()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Example 0:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Question: Do the Cozy Comfort Pullover Set have side pockets?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Real Answer: Yes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Predicted Answer: The Cozy Comfort Pullover Set, Stripe has side pockets on the pull-on pants.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Predicted Grade: CORRECT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Example 1:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Question: What collection is the Ultra-Lofty 850 Stretch Down Hooded Jacket from?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Real Answer: The DownTek collection</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Predicted Answer: The Ultra-Lofty 850 Stretch Down Hooded Jacket is from the DownTek collection.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Predicted Grade: CORRECT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Example 2:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Question: What is the approximate weight of the Women&#x27;s Campside Oxfords per pair?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Real Answer: The approximate weight of the Women&#x27;s Campside Oxfords per pair is 1 lb. 1 oz.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Predicted Answer: The approximate weight of the Women&#x27;s Campside Oxfords per pair is 1 lb. 1 oz.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Predicted Grade: CORRECT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Example 3:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Question: What are the dimensions for the small and medium sizes of the Recycled Waterhog Dog Mat, Chevron Weave?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Real Answer: The dimensions for the small size of the Recycled Waterhog Dog Mat, Chevron Weave are 18&quot; x 28&quot; and the dimensions for the medium size are 22.5&quot; x 34.5&quot;.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Predicted Answer: The dimensions for the small size of the Recycled Waterhog Dog Mat, Chevron Weave are 18&quot; x 28&quot; and the dimensions for the medium size are 22.5&quot; x 34.5&quot;.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Predicted Grade: CORRECT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Example 4:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Question: What are some features of the Infant and Toddler Girls&#x27; Coastal Chill Swimsuit?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Real Answer: The swimsuit features bright colors, ruffles, and exclusive whimsical prints. It is made of four-way-stretch and chlorine-resistant fabric that keeps its shape and resists snags. The swimsuit also has a UPF 50+ rated fabric that provides the highest rated sun protection possible, blocking 98% of the sun&#x27;s harmful rays. The crossover no-slip straps and fully lined bottom ensure a secure fit and maximum coverage.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Predicted Answer: The Infant and Toddler Girls&#x27; Coastal Chill Swimsuit is a two-piece swimsuit with bright colors, ruffles, and exclusive whimsical prints. It is made of four-way-stretch and chlorine-resistant fabric that keeps its shape and resists snags. The swimsuit has UPF 50+ rated fabric that provides the highest rated sun protection possible, blocking 98% of the sun&#x27;s harmful rays. The crossover no-slip straps and fully lined bottom ensure a secure fit and maximum coverage. It is machine washable and should be line dried for best results.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Predicted Grade: CORRECT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Example 5:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Question: What is the fabric composition of the Refresh Swimwear, V-Neck Tankini Contrasts?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Real Answer: The Refresh Swimwear, V-Neck Tankini Contrasts is made of 82% recycled nylon with 18% Lycra® spandex for the body and 90% recycled nylon with 10% Lycra® spandex for lining.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Predicted Answer: The Refresh Swimwear, V-Neck Tankini Contrasts is made of 82% recycled nylon with 18% Lycra® spandex for the body and 90% recycled nylon with 10% Lycra® spandex for the lining.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Predicted Grade: CORRECT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Example 6:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Question: What is the new technology used in the EcoFlex 3L Storm Pants?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Real Answer: The new technology used in the EcoFlex 3L Storm Pants is TEK O2 technology, which offers the most breathability they&#x27;ve ever tested.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Predicted Answer: The new technology used in the EcoFlex 3L Storm Pants is TEK O2 technology, which makes the pants more breathable and waterproof.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Predicted Grade: CORRECT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">graded_outputs[0]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{&#x27;text&#x27;: &#x27;CORRECT&#x27;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="langchain-evaluation-platform">LangChain evaluation platform<a href="#langchain-evaluation-platform" class="hash-link" aria-label="Direct link to LangChain evaluation platform" title="Direct link to LangChain evaluation platform">​</a></h3>
<p>The LangChain evaluation platform, LangChain Plus, can be accessed here <a href="https://www.langchain.plus/" target="_blank" rel="noopener noreferrer">https://www.langchain.plus/</a>. Use the invite code <code>lang_learners_2023</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="agents">Agents<a href="#agents" class="hash-link" aria-label="Direct link to Agents" title="Direct link to Agents">​</a></h2>
<p>What are Agents? We can think of agents as enabling “tools” for LLMs. Like how a human would use a calculator for maths
or perform a Google search for information — agents allow an LLM to do the same thing. See
<a href="https://www.pinecone.io/learn/series/langchain/langchain-agents/" target="_blank" rel="noopener noreferrer">Superpower LLMs with Conversational Agents</a> for more information.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup-5">Setup<a href="#setup-5" class="hash-link" aria-label="Direct link to Setup" title="Direct link to Setup">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from dotenv import load_dotenv, find_dotenv</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">_ = load_dotenv(find_dotenv()) # read local .env file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import warnings</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">warnings.filterwarnings(&quot;ignore&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># account for deprecation of LLM model</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import datetime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Get the current date</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">current_date = datetime.datetime.now().date()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Define the date after which the model should be set to &quot;gpt-3.5-turbo&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">target_date = datetime.date(2024, 6, 12)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Set the model variable based on the current date</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if current_date &gt; target_date:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm_model = &quot;gpt-3.5-turbo&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm_model = &quot;gpt-3.5-turbo-0301&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="built-in-langchain-tools">Built-in LangChain tools<a href="#built-in-langchain-tools" class="hash-link" aria-label="Direct link to Built-in LangChain tools" title="Direct link to Built-in LangChain tools">​</a></h3>
<p>See <a href="https://python.langchain.com/docs/integrations/tools/" target="_blank" rel="noopener noreferrer">Tools</a>,
<a href="https://python.langchain.com/docs/integrations/tools/wikipedia" target="_blank" rel="noopener noreferrer">Wikipedia</a> and
<a href="https://api.python.langchain.com/en/latest/chains/langchain.chains.llm_math.base.LLMMathChain.html" target="_blank" rel="noopener noreferrer">LLMMathChain</a>.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">!pip install -U wikipedia</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.agents.agent_toolkits import create_python_agent</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.agents import load_tools, initialize_agent</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.agents import AgentType</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.tools.python.tool import PythonREPLTool</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.python import PythonREPL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chat_models import ChatOpenAI</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">llm = ChatOpenAI(temperature=0, model=llm_model)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tools = load_tools([&quot;llm-math&quot;, &quot;wikipedia&quot;], llm=llm)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">agent= initialize_agent(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tools, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    agent=AgentType.CHAT_ZERO_SHOT_REACT_DESCRIPTION,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    handle_parsing_errors=True,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    verbose = True)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">agent(&quot;What is the 25% of 300?&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Entering new AgentExecutor chain...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Thought: We need to calculate 25% of 300, which means we need to multiply 300 by 0.25.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Action:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">``</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;action&quot;: &quot;Calculator&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;action_input&quot;: &quot;300*0.25&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">``</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Observation: Answer: 75.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Thought:The calculator tool returned the answer 75.0, which is 25% of 300.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Final Answer: 25% of 300 is 75.0.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Finished chain.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{&#x27;input&#x27;: &#x27;What is the 25% of 300?&#x27;, &#x27;output&#x27;: &#x27;25% of 300 is 75.0.&#x27;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="wikipedia-example">Wikipedia example<a href="#wikipedia-example" class="hash-link" aria-label="Direct link to Wikipedia example" title="Direct link to Wikipedia example">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">question = &quot;Tom M. Mitchell is an American computer scientist \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">and the Founders University Professor at Carnegie Mellon University (CMU)\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">what book did he write?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result = agent(question)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Entering new AgentExecutor chain...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Thought: I should use Wikipedia to find the answer to this question.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Action:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">``</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;action&quot;: &quot;Wikipedia&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;action_input&quot;: &quot;Tom M. Mitchell&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">``</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Observation: Page: Tom M. Mitchell</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Summary: Tom Michael Mitchell (born August 9, 1951) is an American computer scientist and the Founders University </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Professor at Carnegie Mellon University (CMU). He is a founder and former Chair of the Machine Learning Department at </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CMU. Mitchell is known for his contributions to the advancement of machine learning, artificial intelligence, and </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cognitive neuroscience and is the author of the textbook Machine Learning. He is a member of the United States National </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Academy of Engineering since 2010. He is also a Fellow of the American Academy of Arts and Sciences, the American </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Association for the Advancement of Science and a Fellow and past President of the Association for the Advancement of </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Artificial Intelligence. In October 2018, Mitchell was appointed as the Interim Dean of the School of Computer Science </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">at Carnegie Mellon.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Page: Tom Mitchell (Australian footballer)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Summary: Thomas Mitchell (born 31 May 1993) is a professional Australian rules footballer playing for the Collingwood </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Football Club in the Australian Football League (AFL). He previously played for the Sydney Swans from 2012 to 2016, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">and the Hawthorn Football Club between 2017 and 2022. Mitchell won the Brownlow Medal as the league&#x27;s best and fairest </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">player in 2018 and set the record for the most disposals in a VFL/AFL match, accruing 54 in a game against Collingwood </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">during that season.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Thought:The book that Tom M. Mitchell wrote is &quot;Machine Learning&quot;.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Action:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">``</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;action&quot;: &quot;Wikipedia&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;action_input&quot;: &quot;Machine Learning (book)&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">``</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Observation: Page: Machine learning</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Summary: Machine learning (ML) is an umbrella term for solving problems for which development of algorithms by human </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">programmers would be cost-prohibitive, and instead the problems are solved by helping machines &#x27;discover&#x27; their &#x27;own&#x27; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">algorithms, without needing to be explicitly told what to do by any human-developed algorithms. Recently, generative </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">artificial neural networks have been able to surpass results of many previous approaches. Machine learning approaches </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">have been applied to large language models, computer vision, speech recognition, email filtering, agriculture and </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">medicine, where it is too costly to develop algorithms to perform the needed tasks.The mathematical foundations of ML </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">are provided by mathematical optimization (mathematical programming) methods. Data mining is a related (parallel) field </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">of study, focusing on exploratory data analysis through unsupervised learning.ML is known in its application across </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">business problems under the name predictive analytics. Although not all machine learning is statistically-based, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">computational statistics is an important source of the field&#x27;s methods.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Page: Outline of machine learning</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Summary: The following outline is provided as an overview of and topical guide to machine learning. Machine learning is </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a subfield of soft computing within computer science that evolved from the study of pattern recognition and </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">computational learning theory in artificial intelligence. In 1959, Arthur Samuel defined machine learning as a &quot;field </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">of study that gives computers the ability to learn without being explicitly programmed&quot;. Machine learning explores the </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">study and construction of algorithms that can learn from and make predictions on data. Such algorithms operate by </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">building a model from an example training set of input observations in order to make data-driven predictions or </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">decisions expressed as outputs, rather than following strictly static program instructions.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Page: Quantum machine learning</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Summary: Quantum machine learning is the integration of quantum algorithms within machine learning programs.The most </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">common use of the term refers to machine learning algorithms for the analysis of classical data executed on a quantum </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">computer, i.e. quantum-enhanced machine learning. While machine learning algorithms are used to compute immense </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">quantities of data, quantum machine learning utilizes qubits and quantum operations or specialized quantum systems to </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">improve computational speed and data storage done by algorithms in a program. This includes hybrid methods that involve </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">both classical and quantum processing, where computationally difficult subroutines are outsourced to a quantum device. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">These routines can be more complex in nature and executed faster on a quantum computer. Furthermore, quantum algorithms </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">can be used to analyze quantum states instead of classical data.Beyond quantum computing, the term &quot;quantum machine </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">learning&quot; is also associated with classical machine learning methods applied to data generated from quantum experiments </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(i.e. machine learning of quantum systems), such as learning the phase transitions of a quantum system or creating new </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">quantum experiments.Quantum machine learning also extends to a branch of research that explores methodological and </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">structural similarities between certain physical systems and learning systems, in particular neural networks. For </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">example, some mathematical and numerical techniques from quantum physics are applicable to classical deep learning </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">and vice versa.Furthermore, researchers investigate more abstract notions of learning theory with respect to quantum </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">information, sometimes referred to as &quot;quantum learning theory&quot;.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Thought:Tom M. Mitchell wrote the book &quot;Machine Learning&quot;.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Final Answer: The book that Tom M. Mitchell wrote is &quot;Machine Learning&quot;.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Finished chain.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="python-agent">Python Agent<a href="#python-agent" class="hash-link" aria-label="Direct link to Python Agent" title="Direct link to Python Agent">​</a></h3>
<p><a href="https://api.python.langchain.com/en/latest/tools/langchain.tools.python.tool.PythonREPLTool.html" target="_blank" rel="noopener noreferrer">PythonREPLTool</a>
is a tool for running python code in a REPL.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">agent = create_python_agent(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tool=PythonREPLTool(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    verbose=True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">customer_list = [[&quot;Harrison&quot;, &quot;Chase&quot;], </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                 [&quot;Lang&quot;, &quot;Chain&quot;],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                 [&quot;Dolly&quot;, &quot;Too&quot;],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                 [&quot;Elle&quot;, &quot;Elem&quot;], </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                 [&quot;Geoff&quot;,&quot;Fusion&quot;], </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                 [&quot;Trance&quot;,&quot;Former&quot;],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                 [&quot;Jen&quot;,&quot;Ayai&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">agent.run(f&quot;&quot;&quot;Sort these customers by \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">last name and then first name \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">and print the output: {customer_list}&quot;&quot;&quot;) </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Entering new AgentExecutor chain...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">I can use the sorted() function to sort the list of customers by last name and then first name. I will need to provide </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a key function to sorted() that returns a tuple of the last name and first name in that order.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Action: Python REPL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Action Input:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">``</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">customers = [[&#x27;Harrison&#x27;, &#x27;Chase&#x27;], [&#x27;Lang&#x27;, &#x27;Chain&#x27;], [&#x27;Dolly&#x27;, &#x27;Too&#x27;], [&#x27;Elle&#x27;, &#x27;Elem&#x27;], [&#x27;Geoff&#x27;, &#x27;Fusion&#x27;], </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[&#x27;Trance&#x27;, &#x27;Former&#x27;], [&#x27;Jen&#x27;, &#x27;Ayai&#x27;]]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sorted_customers = sorted(customers, key=lambda x: (x[1], x[0]))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">for customer in sorted_customers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    print(customer)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">``</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Observation: [&#x27;Jen&#x27;, &#x27;Ayai&#x27;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[&#x27;Lang&#x27;, &#x27;Chain&#x27;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[&#x27;Harrison&#x27;, &#x27;Chase&#x27;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[&#x27;Elle&#x27;, &#x27;Elem&#x27;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[&#x27;Trance&#x27;, &#x27;Former&#x27;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[&#x27;Geoff&#x27;, &#x27;Fusion&#x27;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[&#x27;Dolly&#x27;, &#x27;Too&#x27;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Thought:The customers are now sorted by last name and then first name. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Final Answer: [[&#x27;Jen&#x27;, &#x27;Ayai&#x27;], [&#x27;Lang&#x27;, &#x27;Chain&#x27;], [&#x27;Harrison&#x27;, &#x27;Chase&#x27;], [&#x27;Elle&#x27;, &#x27;Elem&#x27;], [&#x27;Trance&#x27;, &#x27;Former&#x27;], </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[&#x27;Geoff&#x27;, &#x27;Fusion&#x27;], [&#x27;Dolly&#x27;, &#x27;Too&#x27;]]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Finished chain.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;[[&#x27;Jen&#x27;, &#x27;Ayai&#x27;], [&#x27;Lang&#x27;, &#x27;Chain&#x27;], [&#x27;Harrison&#x27;, &#x27;Chase&#x27;], [&#x27;Elle&#x27;, &#x27;Elem&#x27;], [&#x27;Trance&#x27;, &#x27;Former&#x27;], </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[&#x27;Geoff&#x27;, &#x27;Fusion&#x27;], [&#x27;Dolly&#x27;, &#x27;Too&#x27;]]&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="view-detailed-outputs-of-the-chains">View detailed outputs of the chains<a href="#view-detailed-outputs-of-the-chains" class="hash-link" aria-label="Direct link to View detailed outputs of the chains" title="Direct link to View detailed outputs of the chains">​</a></h3>
<p>To find out exactly what&#x27;s going on under the hood...</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import langchain</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">langchain.debug=True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">agent.run(f&quot;&quot;&quot;Sort these customers by \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">last name and then first name \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">and print the output: {customer_list}&quot;&quot;&quot;) </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">langchain.debug=False</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="define-your-own-tool">Define your own tool<a href="#define-your-own-tool" class="hash-link" aria-label="Direct link to Define your own tool" title="Direct link to Define your own tool">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">!pip install DateTime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.agents import tool</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from datetime import date</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@tool</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">def time(text: str) -&gt; str:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;&quot;&quot;Returns todays date, use this for any questions related to knowing todays date. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    The input should always be an empty string, and this function will always return todays \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    date - any date mathmatics should occur outside this function.&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return str(date.today())</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">agent= initialize_agent(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tools + [time], </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    agent=AgentType.CHAT_ZERO_SHOT_REACT_DESCRIPTION,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    handle_parsing_errors=True,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    verbose = True)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Note:</strong> The agent will sometimes come to the wrong conclusion (agents are a work in progress!).
If it does, please try running it again.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">try:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    result = agent(&quot;whats the date today?&quot;) </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">except: </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    print(&quot;exception on external access&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The preceding code returns this.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Entering new AgentExecutor chain...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Thought: I need to use the `time` tool to get today&#x27;s date.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Action:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">``</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;action&quot;: &quot;time&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;action_input&quot;: &quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">``</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Observation: 2023-08-31</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Thought:I have successfully retrieved today&#x27;s date using the `time` tool.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Final Answer: Today&#x27;s date is August 31, 2023.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; Finished chain.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="see-also">See also<a href="#see-also" class="hash-link" aria-label="Direct link to See also" title="Direct link to See also">​</a></h2>
<ul>
<li><a href="https://www.pinecone.io/learn/series/langchain/" target="_blank" rel="noopener noreferrer">LangChain AI Handbook</a>.</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/lang-chain">LangChain</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/prompts">Prompts</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/chains">Chains</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/agents">Agents</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/deep-learning-ai">DeepLearning.AI</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/courses/langchain-1.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/courses/fine-tuning-llms"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Training and fine-tuning LLMs</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/courses/pair-prog-with-llm"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Pair Programming with a Large Language Model</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#models-prompts-and-parsers" class="table-of-contents__link toc-highlight">Models, Prompts and Parsers</a><ul><li><a href="#setup" class="table-of-contents__link toc-highlight">Setup</a></li><li><a href="#chat-api-openai" class="table-of-contents__link toc-highlight">Chat API: OpenAI</a></li><li><a href="#chat-api-langchain" class="table-of-contents__link toc-highlight">Chat API: LangChain</a></li><li><a href="#output-parsers" class="table-of-contents__link toc-highlight">Output Parsers</a></li><li><a href="#parse-the-llm-output-string-into-a-python-dictionary" class="table-of-contents__link toc-highlight">Parse the LLM output string into a Python dictionary</a></li></ul></li><li><a href="#memory" class="table-of-contents__link toc-highlight">Memory</a><ul><li><a href="#memory-types" class="table-of-contents__link toc-highlight">Memory Types</a></li><li><a href="#setup-1" class="table-of-contents__link toc-highlight">Setup</a></li><li><a href="#conversationbuffermemory" class="table-of-contents__link toc-highlight">ConversationBufferMemory</a></li><li><a href="#conversationbufferwindowmemory" class="table-of-contents__link toc-highlight">ConversationBufferWindowMemory</a></li><li><a href="#conversationtokenbuffermemory" class="table-of-contents__link toc-highlight">ConversationTokenBufferMemory</a></li><li><a href="#conversationsummarymemory" class="table-of-contents__link toc-highlight">ConversationSummaryMemory</a></li></ul></li><li><a href="#chains" class="table-of-contents__link toc-highlight">Chains</a><ul><li><a href="#setup-2" class="table-of-contents__link toc-highlight">Setup</a></li><li><a href="#llmchain" class="table-of-contents__link toc-highlight">LLMChain</a></li><li><a href="#simplesequentialchain" class="table-of-contents__link toc-highlight">SimpleSequentialChain</a></li><li><a href="#router-chain" class="table-of-contents__link toc-highlight">Router Chain</a></li></ul></li><li><a href="#questions-and-answer" class="table-of-contents__link toc-highlight">Questions and Answer</a><ul><li><a href="#setup-3" class="table-of-contents__link toc-highlight">Setup</a></li><li><a href="#step-by-step" class="table-of-contents__link toc-highlight">Step By Step</a></li></ul></li><li><a href="#evaluation" class="table-of-contents__link toc-highlight">Evaluation</a><ul><li><a href="#setup-4" class="table-of-contents__link toc-highlight">Setup</a></li><li><a href="#create-our-qanda-application" class="table-of-contents__link toc-highlight">Create our QandA application</a></li><li><a href="#coming-up-with-test-datapoints" class="table-of-contents__link toc-highlight">Coming up with test datapoints</a></li><li><a href="#hard-coded-examples" class="table-of-contents__link toc-highlight">Hard-coded examples</a></li><li><a href="#llm-generated-examples" class="table-of-contents__link toc-highlight">LLM-Generated examples</a></li><li><a href="#combine-examples" class="table-of-contents__link toc-highlight">Combine examples</a></li><li><a href="#manual-evaluation" class="table-of-contents__link toc-highlight">Manual Evaluation</a></li><li><a href="#llm-assisted-evaluation" class="table-of-contents__link toc-highlight">LLM assisted evaluation</a></li><li><a href="#langchain-evaluation-platform" class="table-of-contents__link toc-highlight">LangChain evaluation platform</a></li></ul></li><li><a href="#agents" class="table-of-contents__link toc-highlight">Agents</a><ul><li><a href="#setup-5" class="table-of-contents__link toc-highlight">Setup</a></li><li><a href="#built-in-langchain-tools" class="table-of-contents__link toc-highlight">Built-in LangChain tools</a></li><li><a href="#wikipedia-example" class="table-of-contents__link toc-highlight">Wikipedia example</a></li><li><a href="#python-agent" class="table-of-contents__link toc-highlight">Python Agent</a></li><li><a href="#view-detailed-outputs-of-the-chains" class="table-of-contents__link toc-highlight">View detailed outputs of the chains</a></li><li><a href="#define-your-own-tool" class="table-of-contents__link toc-highlight">Define your own tool</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li><li><a href="#see-also" class="table-of-contents__link toc-highlight">See also</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Alain Boisvert. Construit avec Docusaurus.</div></div></div></footer></div>
</body>
</html>