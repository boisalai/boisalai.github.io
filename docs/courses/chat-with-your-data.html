<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-courses/chat-with-your-data/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">LangChain: Chat with Your Data | Alain Boisvert</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://boisalai.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://boisalai.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://boisalai.github.io/docs/courses/chat-with-your-data"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="LangChain: Chat with Your Data | Alain Boisvert"><meta data-rh="true" name="description" content="DeepLearning.AI, LangChain: Chat with Your Data."><meta data-rh="true" property="og:description" content="DeepLearning.AI, LangChain: Chat with Your Data."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://boisalai.github.io/docs/courses/chat-with-your-data"><link data-rh="true" rel="alternate" href="https://boisalai.github.io/docs/courses/chat-with-your-data" hreflang="en"><link data-rh="true" rel="alternate" href="https://boisalai.github.io/docs/courses/chat-with-your-data" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Alain Boisvert RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Alain Boisvert Atom Feed">



<link rel="stylesheet" href="/fonts/font-awesome/fontawesome.css">
<link rel="stylesheet" href="/fonts/font-awesome/solid.css">
<link rel="stylesheet" href="/fonts/font-awesome/regular.css">
<link rel="stylesheet" href="/fonts/font-awesome/brands.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.b5c999da.css">
<script src="/assets/js/runtime~main.e6737288.js" defer="defer"></script>
<script src="/assets/js/main.a09b2bce.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Alain Boisvert</b></a><a class="navbar__item navbar__link" target="" href="/docs/courses/ift-7022">IFT-7022</a><a class="navbar__item navbar__link" target="" href="/docs/courses/gif-7005">GIF-7005</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/boisalai" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link fa-brands fa-github"> </a><a href="https://www.linkedin.com/in/alain-boisvert-98b058156/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link fa-brands fa-linkedin-in"> </a><a href="mailto:ay.boisvert@gmail.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link fa-solid fa-envelope"> </a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Alain Boisvert</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cv">Curriculum vitæ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/learning">Learning path</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/certificates">Certificates</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/courses">Courses</a><button aria-label="Collapse sidebar category &#x27;Courses&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/courses/gif-7005">GIF-7005 Introduction à l&#x27;apprentissage automatique</a><button aria-label="Expand sidebar category &#x27;GIF-7005 Introduction à l&#x27;apprentissage automatique&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/courses/ift-7022">IFT-7022 Traitement automatique de la langue naturelle</a><button aria-label="Expand sidebar category &#x27;IFT-7022 Traitement automatique de la langue naturelle&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/courses/chatgpt-building-systems">Building Systems with the ChatGPT API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/courses/chatgpt-prompt-engineering">ChatGPT Prompt Engineering for Developers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/courses/fine-tuning-llms">Training and fine-tuning LLMs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/courses/langchain-1">LangChain for LLM Application Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/courses/pair-prog-with-llm">Pair Programming with a Large Language Model</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/courses/chat-with-your-data">LangChain Chat with Your Data</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/references">References</a><button aria-label="Expand sidebar category &#x27;References&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/code-snippets">Code Snippets</a><button aria-label="Expand sidebar category &#x27;Code Snippets&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/courses"><span itemprop="name">Courses</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">LangChain Chat with Your Data</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>LangChain: Chat with Your Data</h1>
<p><strong>DeepLearning.AI</strong>, <a href="https://www.deeplearning.ai/short-courses/langchain-chat-with-your-data/" target="_blank" rel="noopener noreferrer">LangChain: Chat with Your Data</a>.</p>
<blockquote>
<p>2023-10-11.</p>
</blockquote>
<p>The course delves into two main topics:</p>
<ul>
<li>Retrieval Augmented Generation (RAG), a common LLM application that retrieves contextual documents from an external dataset,</li>
<li>and a guide to building a chatbot that responds to queries based on the content of your documents, rather than the information it has learned in training.</li>
</ul>
<p>You’ll learn about:</p>
<ol>
<li>Document Loading: Learn the fundamentals of data loading and discover over 80 unique loaders LangChain provides to access diverse data sources, including audio and video.</li>
<li>Document Splitting: Discover the best practices and considerations for splitting data.</li>
<li>Vector stores and embeddings: Dive into the concept of embeddings and explore vector store integrations within LangChain.</li>
<li>Retrieval: Grasp advanced techniques for accessing and indexing data in the vector store, enabling you to retrieve the most relevant information beyond semantic queries.</li>
<li>Question Answering: Build a one-pass question-answering solution. 6. Chat: Learn how to track and select pertinent information from conversations and data sources, as you build your own chatbot using LangChain.Start building practical applications that allow you to interact with data using LangChain and LLMs.</li>
</ol>
<p>Learning Objectives</p>
<ul>
<li>Learn directly from LangChain creator, Harrison Chase</li>
<li>Access over 80 unique loaders to handle accessing various data sources using LangChain</li>
<li>Build your own chatbot so chat directly with information from your own documents and data</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2>
<p><strong>Retrieval Augmented Generation</strong></p>
<p><img loading="lazy" alt="s01" src="/assets/images/s01-c1ac1b7929c1b8c50539b226351b6640.png" width="1436" height="966" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="document-loading">Document Loading<a href="#document-loading" class="hash-link" aria-label="Direct link to Document Loading" title="Direct link to Document Loading">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="loaders">Loaders<a href="#loaders" class="hash-link" aria-label="Direct link to Loaders" title="Direct link to Loaders">​</a></h3>
<ul>
<li>Loaders deal with the specifics of accessing and convertig data.<!-- -->
<ul>
<li>Accessing: Web Sites, Data Bases, Youtube, arXiv...</li>
<li>Data Types: PDF, HTML, JSON, Word, PowerPoint...</li>
</ul>
</li>
<li>Returns a list of <code>Document</code> objects.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="retrieval-augmented-generation">Retrieval augmented generation<a href="#retrieval-augmented-generation" class="hash-link" aria-label="Direct link to Retrieval augmented generation" title="Direct link to Retrieval augmented generation">​</a></h3>
<p>In retrieval augmented generation (RAG), an LLM retrieves contextual documents from an external dataset as part of its execution.</p>
<p>This is useful if we want to ask question about specific documents (e.g., our PDFs, a set of videos, etc).</p>
<p><img loading="lazy" alt="s01" src="/assets/images/s02-9fbd91de9282eb806bda1c6db501ecec.jpeg" width="2468" height="707" class="img_ev3q"></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#! pip install langchain</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import openai</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import sys</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sys.path.append(&#x27;../..&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from dotenv import load_dotenv, find_dotenv</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">_ = load_dotenv(find_dotenv()) # read local .env file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">openai.api_key  = os.environ[&#x27;OPENAI_API_KEY&#x27;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pdfs">PDFs<a href="#pdfs" class="hash-link" aria-label="Direct link to PDFs" title="Direct link to PDFs">​</a></h3>
<p>Let&#x27;s load a PDF <a href="https://see.stanford.edu/materials/aimlcs229/transcripts/MachineLearning-Lecture01.pdf" target="_blank" rel="noopener noreferrer">transcript</a>
from Andrew Ng&#x27;s famous CS229 course! These documents are the result of automated transcription so words and sentences are sometimes split unexpectedly.</p>
<p>Each page is a <code>Document</code>. A <code>Document</code> contains text (<code>page_content</code>) and <code>metadata</code>.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># The course will show the pip installs you would need to install packages on your own machine.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># These packages are already installed on this platform and should not be run again.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#! pip install pypdf </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.document_loaders import PyPDFLoader</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">loader = PyPDFLoader(&quot;docs/cs229_lectures/MachineLearning-Lecture01.pdf&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pages = loader.load()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">len(pages)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 22</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">page = pages[0]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(page.page_content[0:500])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(page.metadata)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># {&#x27;source&#x27;: &#x27;docs/cs229_lectures/MachineLearning-Lecture01.pdf&#x27;, &#x27;page&#x27;: 0}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="youtube">Youtube<a href="#youtube" class="hash-link" aria-label="Direct link to Youtube" title="Direct link to Youtube">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.document_loaders.generic import GenericLoader</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.document_loaders.parsers import OpenAIWhisperParser</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.document_loaders.blob_loaders.youtube_audio import YoutubeAudioLoader</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># ! pip install yt_dlp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># ! pip install pydub</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Note</strong>: This can take several minutes to complete.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">url=&quot;https://www.youtube.com/watch?v=jGwO_UgTS7I&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">save_dir=&quot;docs/youtube/&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">loader = GenericLoader(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    YoutubeAudioLoader([url],save_dir),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    OpenAIWhisperParser()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs = loader.load()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs[0].page_content[0:500]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="urls">URLs<a href="#urls" class="hash-link" aria-label="Direct link to URLs" title="Direct link to URLs">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.document_loaders import WebBaseLoader</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">loader = WebBaseLoader(&quot;https://github.com/basecamp/handbook/blob/master/37signals-is-you.md&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs = loader.load()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(docs[0].page_content[:500])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="notion">Notion<a href="#notion" class="hash-link" aria-label="Direct link to Notion" title="Direct link to Notion">​</a></h3>
<p>Follow steps <a href="https://python.langchain.com/docs/modules/data_connection/document_loaders/integrations/notion" target="_blank" rel="noopener noreferrer">here</a> for an example Notion site such as <a href="https://yolospace.notion.site/Blendle-s-Employee-Handbook-e31bff7da17346ee99f531087d8b133f" target="_blank" rel="noopener noreferrer">this one</a>:</p>
<ul>
<li>Duplicate the page into your own Notion space and export as <code>Markdown / CSV</code>.</li>
<li>Unzip it and save it as a folder that contains the markdown file for the Notion page.</li>
</ul>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.document_loaders import NotionDirectoryLoader</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">loader = NotionDirectoryLoader(&quot;docs/Notion_DB&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs = loader.load()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(docs[0].page_content[0:200])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(docs[0].metadata)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="document-splitting">Document Splitting<a href="#document-splitting" class="hash-link" aria-label="Direct link to Document Splitting" title="Direct link to Document Splitting">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="document-splitting-1">Document Splitting<a href="#document-splitting-1" class="hash-link" aria-label="Direct link to Document Splitting" title="Direct link to Document Splitting">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.text_splitter import RecursiveCharacterTextSplitter, CharacterTextSplitter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">chunk_size = 26</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">chunk_overlap = 4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">r_splitter = RecursiveCharacterTextSplitter(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chunk_size=chunk_size,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chunk_overlap=chunk_overlap</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">c_splitter = CharacterTextSplitter(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chunk_size=chunk_size,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chunk_overlap=chunk_overlap</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">text1 = &#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">r_splitter.split_text(text1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># [&#x27;abcdefghijklmnopqrstuvwxyz&#x27;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">text2 = &#x27;abcdefghijklmnopqrstuvwxyzabcdefg&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">r_splitter.split_text(text2)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># [&#x27;abcdefghijklmnopqrstuvwxyz&#x27;, &#x27;wxyzabcdefg&#x27;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">text3 = &quot;a b c d e f g h i j k l m n o p q r s t u v w x y z&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">r_splitter.split_text(text3)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># [&#x27;a b c d e f g h i j k l m&#x27;, &#x27;l m n o p q r s t u v w x&#x27;, &#x27;w x y z&#x27;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">c_splitter.split_text(text3)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># [&#x27;a b c d e f g h i j k l m n o p q r s t u v w x y z&#x27;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">c_splitter = CharacterTextSplitter(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chunk_size=chunk_size,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chunk_overlap=chunk_overlap,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    separator = &#x27; &#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">c_splitter.split_text(text3)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># [&#x27;a b c d e f g h i j k l m&#x27;, &#x27;l m n o p q r s t u v w x&#x27;, &#x27;w x y z&#x27;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="recursive-splitting-details">Recursive splitting details<a href="#recursive-splitting-details" class="hash-link" aria-label="Direct link to Recursive splitting details" title="Direct link to Recursive splitting details">​</a></h3>
<p><code>RecursiveCharacterTextSplitter</code> is recommended for generic text.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">some_text = &quot;&quot;&quot;When writing documents, writers will use document structure to group content. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">This can convey to the reader, which idea&#x27;s are related. For example, closely related ideas \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">are in sentances. Similar ideas are in paragraphs. Paragraphs form a document. \n\n  \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Paragraphs are often delimited with a carriage return or two carriage returns. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Carriage returns are the &quot;backslash n&quot; you see embedded in this string. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Sentences have a period at the end, but also, have a space.\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">and words are separated by space.&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">len(some_text) # 496</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">c_splitter = CharacterTextSplitter(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chunk_size=450,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chunk_overlap=0,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    separator = &#x27; &#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">r_splitter = RecursiveCharacterTextSplitter(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chunk_size=450,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chunk_overlap=0, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    separators=[&quot;\n\n&quot;, &quot;\n&quot;, &quot; &quot;, &quot;&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">c_splitter.split_text(some_text)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">r_splitter.split_text(some_text)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let&#x27;s reduce the chunk size a bit and add a period to our separators:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">r_splitter = RecursiveCharacterTextSplitter(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chunk_size=150,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chunk_overlap=0,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    separators=[&quot;\n\n&quot;, &quot;\n&quot;, &quot;\. &quot;, &quot; &quot;, &quot;&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">r_splitter.split_text(some_text)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">r_splitter = RecursiveCharacterTextSplitter(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chunk_size=150,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chunk_overlap=0,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    separators=[&quot;\n\n&quot;, &quot;\n&quot;, &quot;(?&lt;=\. )&quot;, &quot; &quot;, &quot;&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">r_splitter.split_text(some_text)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.document_loaders import PyPDFLoader</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">loader = PyPDFLoader(&quot;docs/cs229_lectures/MachineLearning-Lecture01.pdf&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pages = loader.load()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.text_splitter import CharacterTextSplitter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">text_splitter = CharacterTextSplitter(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    separator=&quot;\n&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chunk_size=1000,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chunk_overlap=150,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    length_function=len</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs = text_splitter.split_documents(pages)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">len(docs) # 77</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">len(pages) # 22</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.document_loaders import NotionDirectoryLoader</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">loader = NotionDirectoryLoader(&quot;docs/Notion_DB&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">notion_db = loader.load()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs = text_splitter.split_documents(notion_db)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">len(notion_db) # 52</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">len(docs) # 353</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="token-splitting">Token splitting<a href="#token-splitting" class="hash-link" aria-label="Direct link to Token splitting" title="Direct link to Token splitting">​</a></h3>
<p>We can also split on token count explicity, if we want.</p>
<p>This can be useful because LLMs often have context windows designated in tokens.</p>
<p>Tokens are often ~4 characters.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.text_splitter import TokenTextSplitter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">text_splitter = TokenTextSplitter(chunk_size=1, chunk_overlap=0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">text1 = &quot;foo bar bazzyfoo&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">text_splitter.split_text(text1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># [&#x27;foo&#x27;, &#x27; bar&#x27;, &#x27; b&#x27;, &#x27;az&#x27;, &#x27;zy&#x27;, &#x27;foo&#x27;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">text_splitter = TokenTextSplitter(chunk_size=10, chunk_overlap=0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs = text_splitter.split_documents(pages)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs[0]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Document(page_content=&#x27;MachineLearning-Lecture01  \n&#x27;, metadata={&#x27;source&#x27;: &#x27;docs/cs229_lectures/MachineLearning-Lecture01.pdf&#x27;, &#x27;page&#x27;: 0})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pages[0].metadata</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># {&#x27;source&#x27;: &#x27;docs/cs229_lectures/MachineLearning-Lecture01.pdf&#x27;, &#x27;page&#x27;: 0}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="context-aware-splitting">Context aware splitting<a href="#context-aware-splitting" class="hash-link" aria-label="Direct link to Context aware splitting" title="Direct link to Context aware splitting">​</a></h3>
<p>Chunking aims to keep text with common context together.</p>
<p>A text splitting often uses sentences or other delimiters to keep related text together but many documents (such as Markdown) have structure (headers) that can be explicitly used in splitting.</p>
<p>We can use <code>MarkdownHeaderTextSplitter</code> to preserve header metadata in our chunks, as show below.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.document_loaders import NotionDirectoryLoader</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.text_splitter import MarkdownHeaderTextSplitter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">markdown_document = &quot;&quot;&quot;# Title\n\n \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">## Chapter 1\n\n \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Hi this is Jim\n\n Hi this is Joe\n\n \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">### Section \n\n \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Hi this is Lance \n\n </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">## Chapter 2\n\n \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Hi this is Molly&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">headers_to_split_on = [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    (&quot;#&quot;, &quot;Header 1&quot;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    (&quot;##&quot;, &quot;Header 2&quot;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    (&quot;###&quot;, &quot;Header 3&quot;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">markdown_splitter = MarkdownHeaderTextSplitter(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    headers_to_split_on=headers_to_split_on</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">md_header_splits = markdown_splitter.split_text(markdown_document)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">md_header_splits[0]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">md_header_splits[1]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Try on a real Markdown file, like a Notion database.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">loader = NotionDirectoryLoader(&quot;docs/Notion_DB&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs = loader.load()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">txt = &#x27; &#x27;.join([d.page_content for d in docs])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">headers_to_split_on = [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    (&quot;#&quot;, &quot;Header 1&quot;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    (&quot;##&quot;, &quot;Header 2&quot;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">markdown_splitter = MarkdownHeaderTextSplitter(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    headers_to_split_on=headers_to_split_on</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">md_header_splits = markdown_splitter.split_text(txt)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">md_header_splits[0]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="vectorstored-and-embedding">Vectorstored and Embedding<a href="#vectorstored-and-embedding" class="hash-link" aria-label="Direct link to Vectorstored and Embedding" title="Direct link to Vectorstored and Embedding">​</a></h2>
<p>Recall the overall workflow for retrieval augmented generation (RAG):</p>
<p><img loading="lazy" alt="overview.jpeg" src="/assets/images/overview-9fbd91de9282eb806bda1c6db501ecec.jpeg" width="2468" height="707" class="img_ev3q"></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import openai</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import sys</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sys.path.append(&#x27;../..&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from dotenv import load_dotenv, find_dotenv</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">_ = load_dotenv(find_dotenv()) # read local .env file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">openai.api_key  = os.environ[&#x27;OPENAI_API_KEY&#x27;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We just discussed <code>Document Loading</code> and <code>Splitting</code>.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.document_loaders import PyPDFLoader</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Load PDF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">loaders = [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # Duplicate documents on purpose - messy data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    PyPDFLoader(&quot;docs/cs229_lectures/MachineLearning-Lecture01.pdf&quot;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    PyPDFLoader(&quot;docs/cs229_lectures/MachineLearning-Lecture01.pdf&quot;), # Simulate dirty data.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    PyPDFLoader(&quot;docs/cs229_lectures/MachineLearning-Lecture02.pdf&quot;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    PyPDFLoader(&quot;docs/cs229_lectures/MachineLearning-Lecture03.pdf&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs = []</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">for loader in loaders:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docs.extend(loader.load())</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Split</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.text_splitter import RecursiveCharacterTextSplitter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">text_splitter = RecursiveCharacterTextSplitter(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chunk_size = 1500,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chunk_overlap = 150</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">splits = text_splitter.split_documents(docs)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">len(splits)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="embeddings">Embeddings<a href="#embeddings" class="hash-link" aria-label="Direct link to Embeddings" title="Direct link to Embeddings">​</a></h3>
<p>Let&#x27;s take our splits and embed them.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.embeddings.openai import OpenAIEmbeddings</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">embedding = OpenAIEmbeddings()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sentence1 = &quot;i like dogs&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sentence2 = &quot;i like canines&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sentence3 = &quot;the weather is ugly outside&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">embedding1 = embedding.embed_query(sentence1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">embedding2 = embedding.embed_query(sentence2)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">embedding3 = embedding.embed_query(sentence3)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import numpy as np</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">np.dot(embedding1, embedding2)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 0.963185...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">np.dot(embedding1, embedding3)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 0.770999...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">np.dot(embedding2, embedding3)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 0.759633...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="vectorstores">Vectorstores<a href="#vectorstores" class="hash-link" aria-label="Direct link to Vectorstores" title="Direct link to Vectorstores">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># ! pip install chromadb</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.vectorstores import Chroma</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">persist_directory = &#x27;docs/chroma/&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">!rm -rf ./docs/chroma  # remove old database files if any</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">vectordb = Chroma.from_documents(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    documents=splits,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    embedding=embedding,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    persist_directory=persist_directory</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(vectordb._collection.count()) # 209</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="similarity-search">Similarity Search<a href="#similarity-search" class="hash-link" aria-label="Direct link to Similarity Search" title="Direct link to Similarity Search">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">question = &quot;is there an email i can ask for help&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs = vectordb.similarity_search(question, k=3)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(len(docs)) # 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(docs[0].page_content)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let&#x27;s save this so we can use it later!</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">vectordb.persist()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="failure-modes">Failure modes<a href="#failure-modes" class="hash-link" aria-label="Direct link to Failure modes" title="Direct link to Failure modes">​</a></h3>
<p>This seems great, and basic similarity search will get you 80% of the way there very easily.</p>
<p>But there are some failure modes that can creep up.</p>
<p>Here are some edge cases that can arise - we&#x27;ll fix them in the next class.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">question = &quot;what did they say about matlab?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs = vectordb.similarity_search(question, k=5)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs[0]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs[1]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Notice that we&#x27;re getting duplicate chunks (because of the duplicate <code>MachineLearning-Lecture01.pdf</code> in the index).</p>
<p>Semantic search fetches all similar documents, but does not enforce diversity.</p>
<p><code>docs[0]</code> and <code>docs[1]</code> are indentical.</p>
<p>We can see a new failure mode.</p>
<p>The question below asks a question about the third lecture, but includes results from other lectures as well.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">question = &quot;what did they say about regression in the third lecture?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs = vectordb.similarity_search(question,k=5)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">for doc in docs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    print(doc.metadata)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(docs[4].page_content)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Approaches discussed in the next lecture can be used to address both!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="retrieval">Retrieval<a href="#retrieval" class="hash-link" aria-label="Direct link to Retrieval" title="Direct link to Retrieval">​</a></h2>
<p>Retrieval is the centerpiece of our retrieval augmented generation (RAG) flow.</p>
<p>Let&#x27;s get our vectorDB from before.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="vectorstore-retrieval">Vectorstore retrieval<a href="#vectorstore-retrieval" class="hash-link" aria-label="Direct link to Vectorstore retrieval" title="Direct link to Vectorstore retrieval">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import openai</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import sys</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sys.path.append(&#x27;../..&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from dotenv import load_dotenv, find_dotenv</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">_ = load_dotenv(find_dotenv()) # read local .env file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">openai.api_key  = os.environ[&#x27;OPENAI_API_KEY&#x27;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#!pip install lark</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="similarity-search-1">Similarity Search<a href="#similarity-search-1" class="hash-link" aria-label="Direct link to Similarity Search" title="Direct link to Similarity Search">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.vectorstores import Chroma</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.embeddings.openai import OpenAIEmbeddings</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">persist_directory = &#x27;docs/chroma/&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">embedding = OpenAIEmbeddings()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">vectordb = Chroma(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    persist_directory=persist_directory,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    embedding_function=embedding</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(vectordb._collection.count())</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">texts = [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;&quot;&quot;The Amanita phalloides has a large and imposing epigeous (aboveground) fruiting body (basidiocarp).&quot;&quot;&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;&quot;&quot;A mushroom with a large fruiting body is the Amanita phalloides. Some varieties are all-white.&quot;&quot;&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;&quot;&quot;A. phalloides, a.k.a Death Cap, is one of the most poisonous of all known mushrooms.&quot;&quot;&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">smalldb = Chroma.from_texts(texts, embedding=embedding)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">question = &quot;Tell me about all-white mushrooms with large fruiting bodies&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">smalldb.similarity_search(question, k=2)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">smalldb.max_marginal_relevance_search(question,k=2, fetch_k=3)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="addressing-diversity-maximum-marginal-relevance">Addressing Diversity: Maximum marginal relevance<a href="#addressing-diversity-maximum-marginal-relevance" class="hash-link" aria-label="Direct link to Addressing Diversity: Maximum marginal relevance" title="Direct link to Addressing Diversity: Maximum marginal relevance">​</a></h3>
<p>Last class we introduced one problem: how to enforce diversity in the search results.</p>
<p><code>Maximum marginal relevance</code> strives to achieve both relevance to the query <em>and diversity</em> among the results.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">question = &quot;what did they say about matlab?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs_ss = vectordb.similarity_search(question,k=3)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs_ss[0].page_content[:100]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs_ss[1].page_content[:100]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note the difference in results with <code>MMR</code>.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs_mmr = vectordb.max_marginal_relevance_search(question,k=3)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs_mmr[0].page_content[:100]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs_mmr[1].page_content[:100]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="addressing-specificity-working-with-metadata">Addressing Specificity: working with metadata<a href="#addressing-specificity-working-with-metadata" class="hash-link" aria-label="Direct link to Addressing Specificity: working with metadata" title="Direct link to Addressing Specificity: working with metadata">​</a></h3>
<p>In last lecture, we showed that a question about the third lecture can include results from other lectures as well.</p>
<p>To address this, many vectorstores support operations on <code>metadata</code>.</p>
<p><code>metadata</code> provides context for each embedded chunk.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">question = &quot;what did they say about regression in the third lecture?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs = vectordb.similarity_search(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    question,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    k=3,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    filter={&quot;source&quot;:&quot;docs/cs229_lectures/MachineLearning-Lecture03.pdf&quot;}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">for d in docs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    print(d.metadata)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="addressing-specificity-working-with-metadata-using-self-query-retriever">Addressing Specificity: working with metadata using self-query retriever<a href="#addressing-specificity-working-with-metadata-using-self-query-retriever" class="hash-link" aria-label="Direct link to Addressing Specificity: working with metadata using self-query retriever" title="Direct link to Addressing Specificity: working with metadata using self-query retriever">​</a></h3>
<p>But we have an interesting challenge: we often want to infer the metadata from the query itself.</p>
<p>To address this, we can use <code>SelfQueryRetriever</code>, which uses an LLM to extract:</p>
<ol>
<li>The <code>query</code> string to use for vector search</li>
<li>A metadata filter to pass in as well</li>
</ol>
<p>Most vector databases support metadata filters, so this doesn&#x27;t require any new databases or indexes.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.llms import OpenAI</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.retrievers.self_query.base import SelfQueryRetriever</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chains.query_constructor.base import AttributeInfo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata_field_info = [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    AttributeInfo(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        name=&quot;source&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        description=&quot;The lecture the chunk is from, should be one of `docs/cs229_lectures/MachineLearning-Lecture01.pdf`, `docs/cs229_lectures/MachineLearning-Lecture02.pdf`, or `docs/cs229_lectures/MachineLearning-Lecture03.pdf`&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        type=&quot;string&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    AttributeInfo(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        name=&quot;page&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        description=&quot;The page from the lecture&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        type=&quot;integer&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">document_content_description = &quot;Lecture notes&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">llm = OpenAI(temperature=0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">retriever = SelfQueryRetriever.from_llm(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    vectordb,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    document_content_description,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    metadata_field_info,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    verbose=True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">question = &quot;what did they say about regression in the third lecture?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs = retriever.get_relevant_documents(question)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">for d in docs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    print(d.metadata)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>You will receive a warning</strong> about <code>predict_and_parse</code> being deprecated the first time you executing the next line. This can be safely ignored.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-tricks-compression">Additional tricks: compression<a href="#additional-tricks-compression" class="hash-link" aria-label="Direct link to Additional tricks: compression" title="Direct link to Additional tricks: compression">​</a></h3>
<p>Another approach for improving the quality of retrieved docs is compression.</p>
<p>Information most relevant to a query may be buried in a document with a lot of irrelevant text.</p>
<p>Passing that full document through your application can lead to more expensive LLM calls and poorer responses.</p>
<p><strong>Contextual compression</strong> is meant to fix this.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.retrievers import ContextualCompressionRetriever</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.retrievers.document_compressors import LLMChainExtractor</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Wrap our vectorstore</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">llm = OpenAI(temperature=0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">compressor = LLMChainExtractor.from_llm(llm)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">compression_retriever = ContextualCompressionRetriever(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    base_compressor=compressor,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    base_retriever=vectordb.as_retriever()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">def pretty_print_docs(docs):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    print(f&quot;\n{&#x27;-&#x27; * 100}\n&quot;.join([f&quot;Document {i+1}:\n\n&quot; + d.page_content for i, d in enumerate(docs)]))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">question = &quot;what did they say about matlab?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">compressed_docs = compression_retriever.get_relevant_documents(question)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pretty_print_docs(compressed_docs)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="combining-various-techniques">Combining various techniques<a href="#combining-various-techniques" class="hash-link" aria-label="Direct link to Combining various techniques" title="Direct link to Combining various techniques">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">compression_retriever = ContextualCompressionRetriever(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    base_compressor=compressor,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    base_retriever=vectordb.as_retriever(search_type = &quot;mmr&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">question = &quot;what did they say about matlab?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">compressed_docs = compression_retriever.get_relevant_documents(question)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pretty_print_docs(compressed_docs)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="other-types-of-retrieval">Other types of retrieval<a href="#other-types-of-retrieval" class="hash-link" aria-label="Direct link to Other types of retrieval" title="Direct link to Other types of retrieval">​</a></h3>
<p>It&#x27;s worth noting that vectordb as not the only kind of tool to retrieve documents.</p>
<p>The <code>LangChain</code> retriever abstraction includes other ways to retrieve documents, such as TF-IDF or SVM.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.retrievers import SVMRetriever</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.retrievers import TFIDFRetriever</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.document_loaders import PyPDFLoader</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.text_splitter import RecursiveCharacterTextSplitter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Load PDF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">loader = PyPDFLoader(&quot;docs/cs229_lectures/MachineLearning-Lecture01.pdf&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pages = loader.load()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">all_page_text=[p.page_content for p in pages]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">joined_page_text=&quot; &quot;.join(all_page_text)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Split</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">text_splitter = RecursiveCharacterTextSplitter(chunk_size = 1500,chunk_overlap = 150)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">splits = text_splitter.split_text(joined_page_text)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Retrieve</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">svm_retriever = SVMRetriever.from_texts(splits,embedding)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tfidf_retriever = TFIDFRetriever.from_texts(splits)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">question = &quot;What are major topics for this class?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs_svm=svm_retriever.get_relevant_documents(question)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs_svm[0]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">question = &quot;what did they say about matlab?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs_tfidf=tfidf_retriever.get_relevant_documents(question)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs_tfidf[0]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <a href="https://python.langchain.com/docs/modules/data_connection/retrievers/self_query" target="_blank" rel="noopener noreferrer">self-querying</a>
retriever in particular is his favorite.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="question-answering">Question Answering<a href="#question-answering" class="hash-link" aria-label="Direct link to Question Answering" title="Direct link to Question Answering">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h3>
<p>Recall the overall workflow for retrieval augmented generation (RAG):</p>
<p><img loading="lazy" alt="overview.jpeg" src="/assets/images/overview-9fbd91de9282eb806bda1c6db501ecec.jpeg" width="2468" height="707" class="img_ev3q"></p>
<p>We discussed <code>Document Loading</code> and <code>Splitting</code> as well as <code>Storage</code> and <code>Retrieval</code>.</p>
<p><img loading="lazy" alt="s03.png" src="/assets/images/s03-9f27f25e9fb347952b8443e88276c0f5.png" width="1288" height="1450" class="img_ev3q"></p>
<p>Let&#x27;s load our vectorDB.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import openai</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import sys</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sys.path.append(&#x27;../..&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from dotenv import load_dotenv, find_dotenv</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">_ = load_dotenv(find_dotenv()) # read local .env file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">openai.api_key  = os.environ[&#x27;OPENAI_API_KEY&#x27;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The code below was added to assign the openai LLM version filmed until it is deprecated, currently in Sept 2023.
LLM responses can often vary, but the responses may be significantly different when using a different model version.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import datetime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">current_date = datetime.datetime.now().date()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if current_date &lt; datetime.date(2023, 9, 2):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm_name = &quot;gpt-3.5-turbo-0301&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm_name = &quot;gpt-3.5-turbo&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(llm_name)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.vectorstores import Chroma</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.embeddings.openai import OpenAIEmbeddings</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">persist_directory = &#x27;docs/chroma/&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">embedding = OpenAIEmbeddings()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">vectordb = Chroma(persist_directory=persist_directory, embedding_function=embedding)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(vectordb._collection.count()) # 209.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">question = &quot;What are major topics for this class?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs = vectordb.similarity_search(question,k=3)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">len(docs) # 3.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chat_models import ChatOpenAI</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">llm_name = &quot;gpt-3.4-turbo&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">llm = ChatOpenAI(model_name=llm_name, temperature=0)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="retrievalqa-chain">RetrievalQA chain<a href="#retrievalqa-chain" class="hash-link" aria-label="Direct link to RetrievalQA chain" title="Direct link to RetrievalQA chain">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chains import RetrievalQA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">qa_chain = RetrievalQA.from_chain_type(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    retriever=vectordb.as_retriever()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result = qa_chain({&quot;query&quot;: question})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result[&quot;result&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prompt">Prompt<a href="#prompt" class="hash-link" aria-label="Direct link to Prompt" title="Direct link to Prompt">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.prompts import PromptTemplate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Build prompt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">template = &quot;&quot;&quot;Use the following pieces of context to answer the question at the end. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">If you don&#x27;t know the answer, just say that you don&#x27;t know, don&#x27;t try to make up an </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">answer. Use three sentences maximum. Keep the answer as concise as possible. Always </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">say &quot;thanks for asking!&quot; at the end of the answer. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{context}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Question: {question}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Helpful Answer:&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">QA_CHAIN_PROMPT = PromptTemplate.from_template(template)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Run chain</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">qa_chain = RetrievalQA.from_chain_type(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    retriever=vectordb.as_retriever(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return_source_documents=True,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chain_type_kwargs={&quot;prompt&quot;: QA_CHAIN_PROMPT}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">question = &quot;Is probability a class topic?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result = qa_chain({&quot;query&quot;: question})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result[&quot;result&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result[&quot;source_documents&quot;][0]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Three additional methods: Map_reduce, Refine, Map_rerank.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="retrievalqa-chain-types">RetrievalQA chain types<a href="#retrievalqa-chain-types" class="hash-link" aria-label="Direct link to RetrievalQA chain types" title="Direct link to RetrievalQA chain types">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">qa_chain_mr = RetrievalQA.from_chain_type(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    retriever=vectordb.as_retriever(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chain_type=&quot;map_reduce&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result = qa_chain_mr({&quot;query&quot;: question})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result[&quot;result&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you wish to experiment on the <code>LangChain plus platform</code>:</p>
<ul>
<li>Go to <a href="https://www.langchain.plus/" target="_blank" rel="noopener noreferrer">langchain plus platform</a> and sign up</li>
<li>Create an API key from your account&#x27;s settings</li>
<li>Use this API key in the code below</li>
<li>uncomment the code</li>
</ul>
<p>Note, the endpoint in the video differs from the one below. Use the one below.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#import os</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#os.environ[&quot;LANGCHAIN_TRACING_V2&quot;] = &quot;true&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#os.environ[&quot;LANGCHAIN_ENDPOINT&quot;] = &quot;https://api.langchain.plus&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#os.environ[&quot;LANGCHAIN_API_KEY&quot;] = LCP_API_KEY # replace dots with your api key</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">qa_chain_mr = RetrievalQA.from_chain_type(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    retriever=vectordb.as_retriever(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chain_type=&quot;map_reduce&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result = qa_chain_mr({&quot;query&quot;: question})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result[&quot;result&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">qa_chain_mr = RetrievalQA.from_chain_type(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    retriever=vectordb.as_retriever(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chain_type=&quot;refine&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result = qa_chain_mr({&quot;query&quot;: question})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result[&quot;result&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="retrievalqa-limitations">RetrievalQA limitations<a href="#retrievalqa-limitations" class="hash-link" aria-label="Direct link to RetrievalQA limitations" title="Direct link to RetrievalQA limitations">​</a></h3>
<p>QA fails to preserve conversational history.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">qa_chain = RetrievalQA.from_chain_type(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    retriever=vectordb.as_retriever()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">question = &quot;Is probability a class topic?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result = qa_chain({&quot;query&quot;: question})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result[&quot;result&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">question = &quot;why are those prerequesites needed?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result = qa_chain({&quot;query&quot;: question})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result[&quot;result&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note, The LLM response varies. Some responses <strong>do</strong> include a reference to probability which might be gleaned from referenced documents. The point is simply that the model does not have access to past questions or answers, this will be covered in the next section.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="chat">Chat<a href="#chat" class="hash-link" aria-label="Direct link to Chat" title="Direct link to Chat">​</a></h2>
<p>Recall the overall workflow for retrieval augmented generation (RAG):</p>
<p><img loading="lazy" alt="overview.jpeg" src="/assets/images/overview-9fbd91de9282eb806bda1c6db501ecec.jpeg" width="2468" height="707" class="img_ev3q"></p>
<p>We discussed <code>Document Loading</code> and <code>Splitting</code> as well as <code>Storage</code> and <code>Retrieval</code>.</p>
<p>We then showed how <code>Retrieval</code> can be used for output generation in Q+A using <code>RetrievalQA</code> chain.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import openai</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import sys</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sys.path.append(&#x27;../..&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import panel as pn  # GUI</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pn.extension()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from dotenv import load_dotenv, find_dotenv</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">_ = load_dotenv(find_dotenv()) # read local .env file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">openai.api_key  = os.environ[&#x27;OPENAI_API_KEY&#x27;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The code below was added to assign the openai LLM version filmed until it is deprecated, currently in Sept 2023.
LLM responses can often vary, but the responses may be significantly different when using a different model version.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import datetime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">current_date = datetime.datetime.now().date()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if current_date &lt; datetime.date(2023, 9, 2):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm_name = &quot;gpt-3.5-turbo-0301&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">else:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm_name = &quot;gpt-3.5-turbo&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">print(llm_name)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you wish to experiment on <code>LangChain plus platform</code>:</p>
<ul>
<li>Go to <a href="https://www.langchain.plus/" target="_blank" rel="noopener noreferrer">langchain plus platform</a> and sign up</li>
<li>Create an api key from your account&#x27;s settings</li>
<li>Use this api key in the code below</li>
</ul>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#import os</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#os.environ[&quot;LANGCHAIN_TRACING_V2&quot;] = &quot;true&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#os.environ[&quot;LANGCHAIN_ENDPOINT&quot;] = &quot;https://api.langchain.plus&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#os.environ[&quot;LANGCHAIN_API_KEY&quot;] = &quot;...&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.vectorstores import Chroma</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.embeddings.openai import OpenAIEmbeddings</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">persist_directory = &#x27;docs/chroma/&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">embedding = OpenAIEmbeddings()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">vectordb = Chroma(persist_directory=persist_directory, embedding_function=embedding)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">question = &quot;What are major topics for this class?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docs = vectordb.similarity_search(question,k=3)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">len(docs)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chat_models import ChatOpenAI</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">llm = ChatOpenAI(model_name=llm_name, temperature=0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">llm.predict(&quot;Hello world!&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Build prompt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.prompts import PromptTemplate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">template = &quot;&quot;&quot;Use the following pieces of context to answer the question at the end. If you don&#x27;t know the answer, just say that you don&#x27;t know, don&#x27;t try to make up an answer. Use three sentences maximum. Keep the answer as concise as possible. Always say &quot;thanks for asking!&quot; at the end of the answer. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{context}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Question: {question}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Helpful Answer:&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">QA_CHAIN_PROMPT = PromptTemplate(input_variables=[&quot;context&quot;, &quot;question&quot;],template=template,)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Run chain</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chains import RetrievalQA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">question = &quot;Is probability a class topic?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">qa_chain = RetrievalQA.from_chain_type(llm,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                       retriever=vectordb.as_retriever(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                       return_source_documents=True,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                       chain_type_kwargs={&quot;prompt&quot;: QA_CHAIN_PROMPT})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result = qa_chain({&quot;query&quot;: question})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result[&quot;result&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="memory">Memory<a href="#memory" class="hash-link" aria-label="Direct link to Memory" title="Direct link to Memory">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.memory import ConversationBufferMemory</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">memory = ConversationBufferMemory(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    memory_key=&quot;chat_history&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return_messages=True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="conversationalretrievalchain">ConversationalRetrievalChain<a href="#conversationalretrievalchain" class="hash-link" aria-label="Direct link to ConversationalRetrievalChain" title="Direct link to ConversationalRetrievalChain">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chains import ConversationalRetrievalChain</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">retriever=vectordb.as_retriever()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">qa = ConversationalRetrievalChain.from_llm(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    llm,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    retriever=retriever,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    memory=memory</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">question = &quot;Is probability a class topic?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result = qa({&quot;question&quot;: question})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result[&#x27;answer&#x27;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">question = &quot;why are those prerequesites needed?&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result = qa({&quot;question&quot;: question})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result[&#x27;answer&#x27;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img loading="lazy" alt="s04" src="/assets/images/s04-5ca3896cff25c799faacd320c011869b.png" width="1406" height="1446" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-chatbot-that-works-on-your-documents">Create a chatbot that works on your documents<a href="#create-a-chatbot-that-works-on-your-documents" class="hash-link" aria-label="Direct link to Create a chatbot that works on your documents" title="Direct link to Create a chatbot that works on your documents">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.embeddings.openai import OpenAIEmbeddings</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.text_splitter import CharacterTextSplitter, RecursiveCharacterTextSplitter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.vectorstores import DocArrayInMemorySearch</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.document_loaders import TextLoader</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chains import RetrievalQA,  ConversationalRetrievalChain</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.memory import ConversationBufferMemory</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.chat_models import ChatOpenAI</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.document_loaders import TextLoader</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from langchain.document_loaders import PyPDFLoader</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The chatbot code has been updated a bit since filming. The GUI appearance also
varies depending on the platform it is running on.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">def load_db(file, chain_type, k):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # load documents</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    loader = PyPDFLoader(file)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    documents = loader.load()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # split documents</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    text_splitter = RecursiveCharacterTextSplitter(chunk_size=1000, chunk_overlap=150)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    docs = text_splitter.split_documents(documents)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # define embedding</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    embeddings = OpenAIEmbeddings()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # create vector database from data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    db = DocArrayInMemorySearch.from_documents(docs, embeddings)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # define retriever</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    retriever = db.as_retriever(search_type=&quot;similarity&quot;, search_kwargs={&quot;k&quot;: k})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # create a chatbot chain. Memory is managed externally.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    qa = ConversationalRetrievalChain.from_llm(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        llm=ChatOpenAI(model_name=llm_name, temperature=0), </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        chain_type=chain_type, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        retriever=retriever, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return_source_documents=True,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return_generated_question=True,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return qa </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import panel as pn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import param</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class cbfs(param.Parameterized):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chat_history = param.List([])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    answer = param.String(&quot;&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    db_query  = param.String(&quot;&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    db_response = param.List([])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    def __init__(self,  **params):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        super(cbfs, self).__init__( **params)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.panels = []</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.loaded_file = &quot;docs/cs229_lectures/MachineLearning-Lecture01.pdf&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.qa = load_db(self.loaded_file,&quot;stuff&quot;, 4)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    def call_load_db(self, count):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if count == 0 or file_input.value is None:  # init or no file specified :</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return pn.pane.Markdown(f&quot;Loaded File: {self.loaded_file}&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        else:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            file_input.save(&quot;temp.pdf&quot;)  # local copy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            self.loaded_file = file_input.filename</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            button_load.button_style=&quot;outline&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            self.qa = load_db(&quot;temp.pdf&quot;, &quot;stuff&quot;, 4)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            button_load.button_style=&quot;solid&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.clr_history()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return pn.pane.Markdown(f&quot;Loaded File: {self.loaded_file}&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    def convchain(self, query):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if not query:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return pn.WidgetBox(pn.Row(&#x27;User:&#x27;, pn.pane.Markdown(&quot;&quot;, width=600)), scroll=True)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        result = self.qa({&quot;question&quot;: query, &quot;chat_history&quot;: self.chat_history})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.chat_history.extend([(query, result[&quot;answer&quot;])])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.db_query = result[&quot;generated_question&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.db_response = result[&quot;source_documents&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.answer = result[&#x27;answer&#x27;] </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.panels.extend([</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            pn.Row(&#x27;User:&#x27;, pn.pane.Markdown(query, width=600)),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            pn.Row(&#x27;ChatBot:&#x27;, pn.pane.Markdown(self.answer, width=600, style={&#x27;background-color&#x27;: &#x27;#F6F6F6&#x27;}))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        inp.value = &#x27;&#x27;  #clears loading indicator when cleared</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return pn.WidgetBox(*self.panels,scroll=True)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @param.depends(&#x27;db_query &#x27;, )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    def get_lquest(self):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if not self.db_query :</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return pn.Column(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                pn.Row(pn.pane.Markdown(f&quot;Last question to DB:&quot;, styles={&#x27;background-color&#x27;: &#x27;#F6F6F6&#x27;})),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                pn.Row(pn.pane.Str(&quot;no DB accesses so far&quot;))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return pn.Column(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            pn.Row(pn.pane.Markdown(f&quot;DB query:&quot;, styles={&#x27;background-color&#x27;: &#x27;#F6F6F6&#x27;})),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            pn.pane.Str(self.db_query )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @param.depends(&#x27;db_response&#x27;, )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    def get_sources(self):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if not self.db_response:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        rlist=[pn.Row(pn.pane.Markdown(f&quot;Result of DB lookup:&quot;, styles={&#x27;background-color&#x27;: &#x27;#F6F6F6&#x27;}))]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        for doc in self.db_response:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            rlist.append(pn.Row(pn.pane.Str(doc)))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return pn.WidgetBox(*rlist, width=600, scroll=True)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @param.depends(&#x27;convchain&#x27;, &#x27;clr_history&#x27;) </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    def get_chats(self):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if not self.chat_history:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return pn.WidgetBox(pn.Row(pn.pane.Str(&quot;No History Yet&quot;)), width=600, scroll=True)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        rlist=[pn.Row(pn.pane.Markdown(f&quot;Current Chat History variable&quot;, styles={&#x27;background-color&#x27;: &#x27;#F6F6F6&#x27;}))]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        for exchange in self.chat_history:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            rlist.append(pn.Row(pn.pane.Str(exchange)))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return pn.WidgetBox(*rlist, width=600, scroll=True)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    def clr_history(self,count=0):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.chat_history = []</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-chatbot">Create a chatbot<a href="#create-a-chatbot" class="hash-link" aria-label="Direct link to Create a chatbot" title="Direct link to Create a chatbot">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cb = cbfs()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">file_input = pn.widgets.FileInput(accept=&#x27;.pdf&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">button_load = pn.widgets.Button(name=&quot;Load DB&quot;, button_type=&#x27;primary&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">button_clearhistory = pn.widgets.Button(name=&quot;Clear History&quot;, button_type=&#x27;warning&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">button_clearhistory.on_click(cb.clr_history)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">inp = pn.widgets.TextInput( placeholder=&#x27;Enter text here…&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">bound_button_load = pn.bind(cb.call_load_db, button_load.param.clicks)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">conversation = pn.bind(cb.convchain, inp) </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">jpg_pane = pn.pane.Image( &#x27;./img/convchain.jpg&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tab1 = pn.Column(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pn.Row(inp),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pn.layout.Divider(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pn.panel(conversation,  loading_indicator=True, height=300),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pn.layout.Divider(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tab2= pn.Column(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pn.panel(cb.get_lquest),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pn.layout.Divider(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pn.panel(cb.get_sources ),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tab3= pn.Column(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pn.panel(cb.get_chats),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pn.layout.Divider(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tab4=pn.Column(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pn.Row( file_input, button_load, bound_button_load),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pn.Row( button_clearhistory, pn.pane.Markdown(&quot;Clears chat history. Can use to start a new topic&quot; )),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pn.layout.Divider(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pn.Row(jpg_pane.clone(width=400))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dashboard = pn.Column(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pn.Row(pn.pane.Markdown(&#x27;# ChatWithYourData_Bot&#x27;)),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pn.Tabs((&#x27;Conversation&#x27;, tab1), (&#x27;Database&#x27;, tab2), (&#x27;Chat History&#x27;, tab3),(&#x27;Configure&#x27;, tab4))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dashboard</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Feel free to copy this code and modify it to add your own features.</p>
<p>You can try alternate memory and retriever models by changing the configuration in <code>load_db</code> function and the <code>convchain</code> method. <a href="https://panel.holoviz.org/" target="_blank" rel="noopener noreferrer">Panel</a> and <a href="https://param.holoviz.org/" target="_blank" rel="noopener noreferrer">Param</a> have many useful features and widgets you can use to extend the GUI.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="acknowledgments">Acknowledgments<a href="#acknowledgments" class="hash-link" aria-label="Direct link to Acknowledgments" title="Direct link to Acknowledgments">​</a></h3>
<p>Panel based chatbot inspired by Sophia Yang, <a href="https://github.com/sophiamyang/tutorials-LangChain" target="_blank" rel="noopener noreferrer">github</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/courses/chat-with-your-data/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/courses/pair-prog-with-llm"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Pair Programming with a Large Language Model</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/references"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">References</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#document-loading" class="table-of-contents__link toc-highlight">Document Loading</a><ul><li><a href="#loaders" class="table-of-contents__link toc-highlight">Loaders</a></li><li><a href="#retrieval-augmented-generation" class="table-of-contents__link toc-highlight">Retrieval augmented generation</a></li><li><a href="#pdfs" class="table-of-contents__link toc-highlight">PDFs</a></li><li><a href="#youtube" class="table-of-contents__link toc-highlight">Youtube</a></li><li><a href="#urls" class="table-of-contents__link toc-highlight">URLs</a></li><li><a href="#notion" class="table-of-contents__link toc-highlight">Notion</a></li></ul></li><li><a href="#document-splitting" class="table-of-contents__link toc-highlight">Document Splitting</a><ul><li><a href="#document-splitting-1" class="table-of-contents__link toc-highlight">Document Splitting</a></li><li><a href="#recursive-splitting-details" class="table-of-contents__link toc-highlight">Recursive splitting details</a></li><li><a href="#token-splitting" class="table-of-contents__link toc-highlight">Token splitting</a></li><li><a href="#context-aware-splitting" class="table-of-contents__link toc-highlight">Context aware splitting</a></li></ul></li><li><a href="#vectorstored-and-embedding" class="table-of-contents__link toc-highlight">Vectorstored and Embedding</a><ul><li><a href="#embeddings" class="table-of-contents__link toc-highlight">Embeddings</a></li><li><a href="#vectorstores" class="table-of-contents__link toc-highlight">Vectorstores</a></li><li><a href="#similarity-search" class="table-of-contents__link toc-highlight">Similarity Search</a></li><li><a href="#failure-modes" class="table-of-contents__link toc-highlight">Failure modes</a></li></ul></li><li><a href="#retrieval" class="table-of-contents__link toc-highlight">Retrieval</a><ul><li><a href="#vectorstore-retrieval" class="table-of-contents__link toc-highlight">Vectorstore retrieval</a></li><li><a href="#similarity-search-1" class="table-of-contents__link toc-highlight">Similarity Search</a></li><li><a href="#addressing-diversity-maximum-marginal-relevance" class="table-of-contents__link toc-highlight">Addressing Diversity: Maximum marginal relevance</a></li><li><a href="#addressing-specificity-working-with-metadata" class="table-of-contents__link toc-highlight">Addressing Specificity: working with metadata</a></li><li><a href="#addressing-specificity-working-with-metadata-using-self-query-retriever" class="table-of-contents__link toc-highlight">Addressing Specificity: working with metadata using self-query retriever</a></li><li><a href="#additional-tricks-compression" class="table-of-contents__link toc-highlight">Additional tricks: compression</a></li><li><a href="#combining-various-techniques" class="table-of-contents__link toc-highlight">Combining various techniques</a></li><li><a href="#other-types-of-retrieval" class="table-of-contents__link toc-highlight">Other types of retrieval</a></li></ul></li><li><a href="#question-answering" class="table-of-contents__link toc-highlight">Question Answering</a><ul><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#retrievalqa-chain" class="table-of-contents__link toc-highlight">RetrievalQA chain</a></li><li><a href="#prompt" class="table-of-contents__link toc-highlight">Prompt</a></li><li><a href="#retrievalqa-chain-types" class="table-of-contents__link toc-highlight">RetrievalQA chain types</a></li><li><a href="#retrievalqa-limitations" class="table-of-contents__link toc-highlight">RetrievalQA limitations</a></li></ul></li><li><a href="#chat" class="table-of-contents__link toc-highlight">Chat</a><ul><li><a href="#memory" class="table-of-contents__link toc-highlight">Memory</a></li><li><a href="#conversationalretrievalchain" class="table-of-contents__link toc-highlight">ConversationalRetrievalChain</a></li><li><a href="#create-a-chatbot-that-works-on-your-documents" class="table-of-contents__link toc-highlight">Create a chatbot that works on your documents</a></li><li><a href="#create-a-chatbot" class="table-of-contents__link toc-highlight">Create a chatbot</a></li><li><a href="#acknowledgments" class="table-of-contents__link toc-highlight">Acknowledgments</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Alain Boisvert. Construit avec Docusaurus.</div></div></div></footer></div>
</body>
</html>